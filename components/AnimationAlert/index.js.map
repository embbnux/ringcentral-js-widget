{"version":3,"sources":["components/AnimationAlert/index.js"],"names":["ANIMATION_DURATION","ENTRANCE_ANIMATION","EXIT_ANIMATION","AnimationMessage","animation","duration","props","second","animationDuration","propTypes","Message","PropTypes","string","number","defaultProps","undefined","AnimationAlert","state","messages","mounted","nextProps","entranceAnimation","exitAnimation","currentMessagesIDs","map","message","id","nextMessagesIDs","addedMessagesIDs","filter","removedMessagesIDs","allMessagesIDs","concat","allMessages","isAddedMessage","isRemovedMessage","stateWithAnimation","length","setState","isCurrentEmpty","nextState","Component","AlertDisplay"],"mappings":"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","file":"index.js","sourcesContent":["import { contains } from 'ramda';\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport 'animate.css/animate.min.css';\nimport sleep from 'ringcentral-integration/lib/sleep';\n\nimport Message from '../Message';\nimport AlertDisplay from '../AlertDisplay';\n\nconst ANIMATION_DURATION = 500;\nconst ENTRANCE_ANIMATION = 'fadeInDown';\nconst EXIT_ANIMATION = 'fadeOutUp';\n\nfunction AnimationMessage({ animation, duration, ...props }) {\n  const second = duration / 1000;\n  return (\n    <div\n      className={classnames([animation, 'animated'])}\n      style={{\n        animationDuration: `${second}s`\n      }}>\n      <Message {...props} />\n    </div>\n  );\n}\n\nAnimationMessage.propTypes = {\n  ...Message.propTypes,\n  animation: PropTypes.string,\n  duration: PropTypes.number,\n};\nAnimationMessage.defaultProps = {\n  animation: undefined,\n  duration: ANIMATION_DURATION,\n};\n\nclass AnimationAlert extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      messages: this.props.messages,\n    };\n  }\n  componentDidMount() {\n    this.mounted = true;\n  }\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n  componentWillReceiveProps(nextProps) {\n    if (this.props.messages === nextProps.messages) return;\n    (async () => {\n      const {\n        duration,\n        entranceAnimation,\n        exitAnimation,\n      } = this.props;\n      const currentMessagesIDs = this.props.messages.map(message => message.id);\n      const nextMessagesIDs = nextProps.messages.map(message => message.id);\n      const addedMessagesIDs = nextMessagesIDs.filter(id => !contains(id, currentMessagesIDs));\n      const removedMessagesIDs = currentMessagesIDs.filter(id => !contains(id, nextMessagesIDs));\n      const allMessagesIDs = [...new Set(currentMessagesIDs.concat(nextMessagesIDs))];\n      const allMessages = {};\n      this.props.messages.concat(nextProps.messages).map((message) => {\n        allMessages[message.id] = message;\n        return message;\n      });\n      const messages = allMessagesIDs\n        .map((id) => {\n          const message = allMessages[id];\n          const isAddedMessage = contains(id, addedMessagesIDs);\n          const isRemovedMessage = contains(id, removedMessagesIDs);\n          let animation;\n          if (isAddedMessage) {\n            animation = entranceAnimation;\n          } else if (isRemovedMessage) {\n            animation = exitAnimation;\n          }\n          return {\n            ...message,\n            ...animation ? { animation } : {},\n            duration,\n          };\n        });\n      const stateWithAnimation = {\n        messages,\n      };\n      if (messages.length > 0) {\n        this.setState(stateWithAnimation);\n      }\n      await sleep(duration);\n      if (!this.mounted) return;\n      const isCurrentEmpty = currentMessagesIDs.length === 0;\n      this.setState({\n        messages: isCurrentEmpty ? messages : nextProps.messages,\n      });\n    })();\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return !(\n      nextState.messages === this.state.messages || nextProps.messages === this.state.props\n    );\n  }\n\n  render() {\n    return (\n      <AlertDisplay {...this.props} component={AnimationMessage} messages={this.state.messages} />\n    );\n  }\n}\n\nAnimationAlert.propTypes = {\n  ...AlertDisplay.propTypes,\n  entranceAnimation: PropTypes.string,\n  exitAnimation: PropTypes.string,\n  duration: PropTypes.number,\n};\n\nAnimationAlert.defaultProps = {\n  ...AlertDisplay.defaultProps,\n  entranceAnimation: ENTRANCE_ANIMATION,\n  exitAnimation: EXIT_ANIMATION,\n  duration: ANIMATION_DURATION,\n};\n\nexport default AnimationAlert;\n"]}