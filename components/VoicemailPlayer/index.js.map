{"version":3,"sources":["components/VoicemailPlayer/index.js"],"names":["audiosMap","VoicemailPlayer","props","state","playing","paused","progress","_id","uri","split","pop","Date","getTime","_audio","Audio","preload","volume","addEventListener","_mounted","setState","currentTime","duration","isPlaying","console","error","_playAudio","src","load","_pauseOtherAudios","_playPromise","play","onPlay","_pauseAudio","undefined","then","pause","_onDownloadClick","e","disabled","preventDefault","forEach","id","otherAudio","className","currentLocale","icon","styles","i18n","getString","root","startTime","download","endTime","all","done","width","current","left","Component","propTypes","PropTypes","number","string","isRequired","func","bool","defaultProps"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\n\nimport formatDuration from '../../lib/formatDuration';\nimport DownloadIcon from '../../assets/images/Download.svg';\nimport PlayIcon from '../../assets/images/Play.svg';\nimport PauseIcon from '../../assets/images/Pause.svg';\n\nimport Button from '../Button';\n\nimport styles from './styles.scss';\nimport i18n from './i18n';\n\nconst audiosMap = {};\n\nclass VoicemailPlayer extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      playing: false,\n      paused: false,\n      progress: 0,\n    };\n\n    this._id = `${props.uri && props.uri.split('?')[0].split('/').pop()}/${(new Date()).getTime()}`;\n    this._audio = new Audio();\n    this._audio.preload = false;\n    this._audio.volume = 1;\n    audiosMap[this._id] = this._audio;\n    this._audio.addEventListener('timeupdate', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        progress: (this._audio.currentTime / this._audio.duration),\n      });\n    });\n\n    this._audio.addEventListener('ended', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        playing: false,\n      });\n      this._audio.isPlaying = false;\n    });\n\n    this._audio.addEventListener('pause', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        paused: true,\n        playing: false,\n      });\n      this._audio.isPlaying = false;\n    });\n\n    this._audio.addEventListener('play', () => {\n      if (!this._mounted) {\n        return;\n      }\n      this.setState({\n        playing: true,\n        paused: false,\n      });\n      this._audio.isPlaying = true;\n    });\n\n    this._audio.addEventListener('error', () => {\n      console.error(this._audio.error);\n    });\n\n    this._playAudio = () => {\n      if (this.state.playing) {\n        return;\n      }\n      if (!this.state.paused) {\n        this._audio.src = this.props.uri;\n        this._audio.load(this.props.uri);\n        if (!Number.isNaN(this._audio.duration)) {\n          this._audio.currentTime = 0;\n        }\n      }\n      this._pauseOtherAudios();\n      this._audio._playPromise = this._audio.play();\n      if (typeof this.props.onPlay === 'function') {\n        this.props.onPlay();\n      }\n    };\n\n    this._pauseAudio = () => {\n      if (this.state.paused) {\n        return;\n      }\n      if (this._audio._playPromise !== undefined) {\n        this._audio._playPromise.then(() => {\n          this._audio.pause();\n        });\n      }\n    };\n\n    this._onDownloadClick = (e) => {\n      if (this.props.disabled) {\n        e.preventDefault();\n      }\n    };\n  }\n\n  _pauseOtherAudios() {\n    Object.keys(audiosMap).forEach((id) => {\n      if (id === this._id) {\n        return;\n      }\n      const otherAudio = audiosMap[id];\n      if (otherAudio.isPlaying && otherAudio._playPromise) {\n        otherAudio._playPromise.then(() => {\n          otherAudio.pause();\n        });\n      }\n    });\n  }\n\n  componentDidMount() {\n    this._mounted = true;\n  }\n\n  componentWillUnmount() {\n    this._mounted = false;\n    if (!Number.isNaN(this._audio.duration)) {\n      this._audio.currentTime = 0;\n    }\n    this._audio.pause();\n    delete audiosMap[this._id];\n  }\n\n  render() {\n    const {\n      className,\n      duration,\n      uri,\n      disabled,\n      currentLocale,\n    } = this.props;\n    let icon;\n    if (this.state.playing) {\n      icon = (\n        <Button\n          className={classnames(styles.play, (disabled ? styles.disabled : null))}\n          onClick={this._pauseAudio}\n          disabled={disabled}\n        >\n          <span title={i18n.getString('pause', currentLocale)}>\n            <PauseIcon width={18} height={18} />\n          </span>\n        </Button>\n      );\n    } else {\n      icon = (\n        <Button\n          className={classnames(styles.play, (disabled ? styles.disabled : null))}\n          onClick={this._playAudio}\n          disabled={disabled}\n        >\n          <span title={i18n.getString('play', currentLocale)}>\n            <PlayIcon width={18} height={18} />\n          </span>\n        </Button>\n      );\n    }\n    const currentTime =\n      (this._audio.currentTime < duration) ? this._audio.currentTime : duration;\n    return (\n      <div className={classnames(styles.root, className)}>\n        {icon}\n        <span className={styles.startTime}>{formatDuration(currentTime)}</span>\n        <a\n          className={classnames(styles.download, (disabled ? styles.disabled : null))}\n          target=\"_blank\"\n          download\n          title={i18n.getString('download', currentLocale)}\n          href={uri}\n          onClick={this._onDownloadClick}\n        >\n          <DownloadIcon width={18} height={18} />\n        </a>\n        <span className={styles.endTime}>{formatDuration(duration)}</span>\n        <div className={styles.progress}>\n          <div className={styles.all} />\n          <div className={styles.done} style={{ width: `${this.state.progress * 100}%` }} />\n          <div className={styles.current} style={{ left: `${this.state.progress * 100}%` }} />\n        </div>\n      </div>\n    );\n  }\n}\n\nVoicemailPlayer.propTypes = {\n  duration: PropTypes.number,\n  uri: PropTypes.string.isRequired,\n  className: PropTypes.string,\n  onPlay: PropTypes.func,\n  disabled: PropTypes.bool,\n  currentLocale: PropTypes.string.isRequired,\n};\n\nVoicemailPlayer.defaultProps = {\n  duration: 0,\n  className: undefined,\n  onPlay: undefined,\n  disabled: false,\n};\n\nexport default VoicemailPlayer;\n"]}