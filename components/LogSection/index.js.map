{"version":3,"sources":["components/LogSection/index.js"],"names":["LogSection","props","state","mainCtrlOverlapped","window","addEventListener","checkOverlap","removeEventListener","mainCtrl","scrollHeight","clientHeight","scrollTop","overlappedHeight","setState","renderEditLogSection","currentLocale","onSaveCallLog","onUpdateCallLog","currentLog","additionalInfo","editLogSection","ref","styles","editSection","showSaveLogBtn","renderSaveLogButton","call","currentLogCall","buttonPanelClassName","buttonPanel","overlapped","buttonClassName","primaryButton","isSaving","disabled","i18n","getString","formatPhone","currentlog","currentSessionId","telephonyStatus","result","status","genLogBasicInfo","disabledToCallControl","callDirections","inbound","direction","telephonyStatuses","ringing","onLogBasicInfoClick","wrapperCls","basicInfoWrapper","pointer","infoWithCtrlWrapper","callCtrlWrapper","renderSmallCallContrl","isInnerMask","showSmallCallControl","showSpinner","spinner","section","genLogBasicInfoWithSmallCallCtrl","genEditLogSection","genSaveLogButton","innerMask","Component","propTypes","PropTypes","object","string","isRequired","func","bool","defaultProps","undefined"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport telephonyStatuses from 'ringcentral-integration/enums/telephonyStatus';\nimport callDirections from 'ringcentral-integration/enums/callDirections';\n\nimport SpinnerOverlay from '../SpinnerOverlay';\nimport Button from '../Button';\nimport styles from './styles.scss';\nimport LogBasicInfo from '../LogBasicInfo';\nimport i18n from './i18n';\n\nexport default class LogSection extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      mainCtrlOverlapped: false\n    };\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.checkOverlap, false);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.checkOverlap, false);\n  }\n\n  checkOverlap() {\n    if (!this.mainCtrl) {\n      return;\n    }\n    const {\n      scrollHeight,\n      clientHeight,\n      scrollTop\n    } = this.mainCtrl;\n    const overlappedHeight = scrollHeight - clientHeight - scrollTop;\n    const mainCtrlOverlapped = overlappedHeight > 1;\n    if (mainCtrlOverlapped !== this.state.mainCtrlOverlapped) {\n      this.setState({ mainCtrlOverlapped });\n    }\n  }\n\n  genEditLogSection() {\n    const {\n      renderEditLogSection, currentLocale,\n      onSaveCallLog, onUpdateCallLog,\n      currentLog, additionalInfo\n    } = this.props;\n    const editLogSection = renderEditLogSection({\n      currentLocale,\n      onSaveCallLog,\n      onUpdateCallLog,\n      currentLog,\n      additionalInfo,\n    });\n    return (\n      <div\n        ref={(ref) => { this.mainCtrl = ref; }}\n        onScroll={() => this.checkOverlap()}\n        className={styles.editSection}>\n        {editLogSection}\n      </div>\n    );\n  }\n\n  genSaveLogButton() {\n    const {\n      showSaveLogBtn, renderSaveLogButton,\n      currentLocale, onSaveCallLog,\n      currentLog\n    } = this.props;\n    const {\n      call,\n      currentLogCall,\n    } = currentLog;\n    const buttonPanelClassName = classnames(\n      styles.buttonPanel,\n      this.state.mainCtrlOverlapped && styles.overlapped\n    );\n    const buttonClassName = classnames(\n      styles.primaryButton,\n      currentLogCall.isSaving && styles.disabled\n    );\n    if (!showSaveLogBtn) {\n      return null;\n    }\n    if (renderSaveLogButton) {\n      return renderSaveLogButton({\n        currentLocale,\n        onSaveCallLog,\n        currentLog,\n        overlapped: this.state.mainCtrlOverlapped\n      });\n    }\n    return (\n      <div\n        className={buttonPanelClassName}>\n        <Button\n          disabled={currentLogCall.isSaving}\n          className={buttonClassName}\n          onClick={() => onSaveCallLog(call)}>\n          {i18n.getString('saveLog', currentLocale)}\n        </Button>\n      </div>\n    );\n  }\n\n  genLogBasicInfo() {\n    return (\n      <LogBasicInfo\n        currentLog={this.props.currentLog}\n        currentLocale={this.props.currentLocale}\n        formatPhone={this.props.formatPhone}\n      />\n    );\n  }\n\n  genLogBasicInfoWithSmallCallCtrl() {\n    const currentlog = this.props.currentLog;\n    const { currentSessionId, call } = currentlog;\n    const { telephonyStatus, result } = call;\n    const status = telephonyStatus || result;\n    // if `result` is exist, call has been disconnect\n    if (result) {\n      return this.genLogBasicInfo();\n    }\n    function disabledToCallControl() {\n      return (\n        callDirections.inbound === call.direction &&\n        telephonyStatuses.ringing === telephonyStatus\n      );\n    }\n\n    const onLogBasicInfoClick = disabledToCallControl()\n      ? () => { }\n      : this.props.onLogBasicInfoClick;\n\n    const wrapperCls = classnames(styles.basicInfoWrapper, {\n      [styles.pointer]: !disabledToCallControl()\n    });\n    return (\n      <div className={styles.infoWithCtrlWrapper}>\n        <div className={wrapperCls} onClick={onLogBasicInfoClick}>\n          <LogBasicInfo\n            currentLog={this.props.currentLog}\n            currentLocale={this.props.currentLocale}\n            formatPhone={this.props.formatPhone}\n          />\n        </div>\n        <div className={styles.callCtrlWrapper}>\n          {this.props.renderSmallCallContrl(status, currentSessionId)}\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    const {\n      currentLog,\n      isInnerMask,\n      showSmallCallControl\n    } = this.props;\n    const {\n      showSpinner,\n    } = currentLog;\n    if (showSpinner) {\n      return (<SpinnerOverlay className={styles.spinner} />);\n    }\n\n    return (\n      <div className={styles.section}>\n        {showSmallCallControl ? this.genLogBasicInfoWithSmallCallCtrl() : this.genLogBasicInfo()}\n        {this.genEditLogSection()}\n        {this.genSaveLogButton()}\n        {\n          isInnerMask ? (\n            <div className={styles.innerMask} />\n          ) : null\n        }\n      </div>);\n  }\n}\n\nLogSection.propTypes = {\n  currentLog: PropTypes.object,\n  additionalInfo: PropTypes.object,\n  currentLocale: PropTypes.string.isRequired,\n  formatPhone: PropTypes.func,\n  onUpdateCallLog: PropTypes.func,\n  onSaveCallLog: PropTypes.func,\n  renderEditLogSection: PropTypes.func,\n  renderSaveLogButton: PropTypes.func,\n  isInnerMask: PropTypes.bool,\n  onLogBasicInfoClick: PropTypes.func,\n  showSaveLogBtn: PropTypes.bool,\n  showSmallCallControl: PropTypes.bool,\n  renderSmallCallContrl: PropTypes.func,\n};\n\nLogSection.defaultProps = {\n  currentLog: {},\n  additionalInfo: undefined,\n  formatPhone: undefined,\n  onUpdateCallLog: undefined,\n  onSaveCallLog: undefined,\n  renderEditLogSection: undefined,\n  renderSaveLogButton: undefined,\n  isInnerMask: undefined,\n  onLogBasicInfoClick() { },\n  renderSmallCallContrl() { },\n  showSaveLogBtn: true,\n  showSmallCallControl: true,\n};\n"]}