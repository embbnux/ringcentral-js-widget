{"version":3,"sources":["lib/DataMatcher/getDefaultDataReducer.js"],"names":["getDefaultDataReducer","actionTypes","state","type","data","name","ttl","timestamp","queries","shouldCleanUpAll","matchSuccess","newState","forEach","query","length","_t","cleanUp","hasChanges","queriesMap","resetSuccess"],"mappings":";;;;;;;;;;;;;;;;;;kBACwBA,qB;;;;AAAT,SAASA,qBAAT,CAA+BC,WAA/B,EAA4C;AACzD,SAAO,YAQD;AAAA,QAREC,KAQF,uEARU,EAQV;AAAA;AAAA,QAPJC,IAOI,QAPJA,IAOI;AAAA,QANJC,IAMI,QANJA,IAMI;AAAA,QALJC,IAKI,QALJA,IAKI;AAAA,QAJJC,GAII,QAJJA,GAII;AAAA,QAHJC,SAGI,QAHJA,SAGI;AAAA,QAFJC,OAEI,QAFJA,OAEI;AAAA,qCADJC,gBACI;AAAA,QADJA,gBACI,yCADe,KACf;;AACJ,YAAQN,IAAR;AACE,WAAKF,YAAYS,YAAjB;AAA+B;AAC7B,cAAMC,sCAAgBT,KAAhB,CAAN;AACAM,kBAAQI,OAAR,CAAgB,UAACC,KAAD,EAAW;AACzB,gBAAIT,KAAKS,KAAL,KAAeT,KAAKS,KAAL,EAAYC,MAA/B,EAAuC;AACrCH,uBAASE,KAAT,+BACKF,SAASE,KAAT,CADL,oCAEGR,IAFH,EAEU;AACND,sBAAMA,KAAKS,KAAL,CADA;AAENE,oBAAIR;AAFE,eAFV;AAOD,aARD,MAQO;AACL;AACAI,uBAASE,KAAT,+BACKF,SAASE,KAAT,CADL,oCAEGR,IAFH,EAEU;AACNU,oBAAIR,SADE,EACS;AACfH,sBAAM;AAFA,eAFV;AAOD;AACF,WAnBD;AAoBA,iBAAOO,QAAP;AACD;AACD,WAAKV,YAAYe,OAAjB;AAA0B;AACxB,cAAIP,gBAAJ,EAAsB;AACpB,mBAAO,EAAP;AACD;AACD,cAAME,YAAW,EAAjB;AACA,cAAIM,aAAa,KAAjB;;AAEA;AACA,cAAMC,aAAa,EAAnB;AACAV,kBAAQI,OAAR,CAAgB,UAACC,KAAD,EAAW;AACzBK,uBAAWL,KAAX,IAAoB,IAApB;AACD,WAFD;AAGA,8BAAYX,KAAZ,EAAmBU,OAAnB,CAA2B,UAACC,KAAD,EAAW;AACpC,gBAAI,CAACK,WAAWL,KAAX,CAAL,EAAwB;AACtB,kBAAI,CAACX,MAAMW,KAAN,EAAaE,EAAlB,EAAsB;AACpB;AACAJ,0BAASE,KAAT,+BACKX,MAAMW,KAAN,CADL;AAEEE,sBAAIR;AAFN;AAIAU,6BAAa,IAAb;AACD,eAPD,MAOO,IAAIV,YAAYL,MAAMW,KAAN,EAAaE,EAAzB,GAA8BT,GAAlC,EAAuC;AAC5C;AACAK,0BAASE,KAAT,IAAkBX,MAAMW,KAAN,CAAlB;AACD,eAHM,MAGA;AACL;AACAI,6BAAa,IAAb;AACD;AACF,aAfD,MAeO,IAAIf,MAAMW,KAAN,EAAaE,EAAjB,EAAqB;AAC1B;AACA;AACAJ,wBAASE,KAAT,+BACKX,MAAMW,KAAN,CADL;AAGA,qBAAOF,UAASE,KAAT,EAAgBE,EAAvB;AACAE,2BAAa,IAAb;AACD,aARM,MAQA;AACLN,wBAASE,KAAT,IAAkBX,MAAMW,KAAN,CAAlB;AACD;AACF,WA3BD;AA4BA,iBAAOI,aACLN,SADK,GAELT,KAFF;AAGD;AACD,WAAKD,YAAYkB,YAAjB;AACE,eAAO,EAAP;AACF;AACE,eAAOjB,KAAP;AAxEJ;AA0ED,GAnFD;AAoFD","file":"getDefaultDataReducer.js","sourcesContent":["\nexport default function getDefaultDataReducer(actionTypes) {\n  return (state = {}, {\n    type,\n    data,\n    name,\n    ttl,\n    timestamp,\n    queries,\n    shouldCleanUpAll = false,\n  }) => {\n    switch (type) {\n      case actionTypes.matchSuccess: {\n        const newState = { ...state };\n        queries.forEach((query) => {\n          if (data[query] && data[query].length) {\n            newState[query] = {\n              ...newState[query],\n              [name]: {\n                data: data[query],\n                _t: timestamp,\n              },\n            };\n          } else {\n            // assume match not found if not in data\n            newState[query] = {\n              ...newState[query],\n              [name]: {\n                _t: timestamp, // for noMatchTtl check\n                data: [],\n              },\n            };\n          }\n        });\n        return newState;\n      }\n      case actionTypes.cleanUp: {\n        if (shouldCleanUpAll) {\n          return {};\n        }\n        const newState = {};\n        let hasChanges = false;\n\n        // optimize for large queries list\n        const queriesMap = {};\n        queries.forEach((query) => {\n          queriesMap[query] = true;\n        });\n        Object.keys(state).forEach((query) => {\n          if (!queriesMap[query]) {\n            if (!state[query]._t) {\n              // mark for deletion\n              newState[query] = {\n                ...state[query],\n                _t: timestamp,\n              };\n              hasChanges = true;\n            } else if (timestamp - state[query]._t < ttl) {\n              // not expired yet\n              newState[query] = state[query];\n            } else {\n              // entry is removed\n              hasChanges = true;\n            }\n          } else if (state[query]._t) {\n            // if entry shows up in queries again\n            // remove the timestamp\n            newState[query] = {\n              ...state[query],\n            };\n            delete newState[query]._t;\n            hasChanges = true;\n          } else {\n            newState[query] = state[query];\n          }\n        });\n        return hasChanges ?\n          newState :\n          state;\n      }\n      case actionTypes.resetSuccess:\n        return {};\n      default:\n        return state;\n    }\n  };\n}\n"]}