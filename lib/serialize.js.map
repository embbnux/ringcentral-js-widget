{"version":3,"sources":["lib/serialize.js"],"names":["serialize","target","key","descriptor","prev","serializeFunc","args","next","resolve","value","apply","then"],"mappings":";;;;;;;;;;;;;;kBAUwBA,S;;;;AAVxB;;;;;;;;;;AAUe,SAASA,SAAT,CAAmBC,MAAnB,EAA2BC,GAA3B,EAAgCC,UAAhC,EAA4C;AACzD,MAAIC,OAAO,IAAX;AACA,WAASC,aAAT,GAAgC;AAAA;;AAAA,sCAANC,IAAM;AAANA,UAAM;AAAA;;AAC9B,QAAMC,OAAO,SAAPA,IAAO;AAAA,aAAM,kBAAQC,OAAR,CACjBL,WAAWM,KAAX,CAAiBC,KAAjB,CAAuB,KAAvB,EAA6BJ,IAA7B,CADiB,EAEjBK,IAFiB,CAEZ,YAAM;AACXP,eAAO,IAAP;AACD,OAJkB,CAAN;AAAA,KAAb;AAKAA,WAAOA,OAAOA,KAAKO,IAAL,CAAUJ,IAAV,CAAP,GAAyBA,MAAhC;AACA,WAAOH,IAAP;AACD;;AAED,oCACKD,UADL;AAEEM,WAAOJ;AAFT;AAID","file":"serialize.js","sourcesContent":["/**\n * A decorator for making sure specific function being invoked serializely.\n *\n * Usage:\n * class A {\n *   @serialize\n *   async foo() {}\n * }\n *\n */\nexport default function serialize(target, key, descriptor) {\n  let prev = null;\n  function serializeFunc(...args) {\n    const next = () => Promise.resolve(\n      descriptor.value.apply(this, args)\n    ).then(() => {\n      prev = null;\n    });\n    prev = prev ? prev.then(next) : next();\n    return prev;\n  }\n\n  return {\n    ...descriptor,\n    value: serializeFunc,\n  };\n}\n"]}