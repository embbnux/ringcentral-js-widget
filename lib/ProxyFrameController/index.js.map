{"version":3,"sources":["lib/ProxyFrameController/index.js"],"names":["ProxyFrameController","prefix","url","parse","window","location","href","query","uuid","oAuthCallback","callbackUri","parent","postMessage","addEventListener","data","oAuthUri","search","parsedUri","uri","format","state","undefined","key","e","newValue","localStorage","removeItem","proxyLoaded"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;;;IAEqBA,oB,GACnB,gCAEQ;AAAA,iFAAJ,EAAI;AAAA,MADNC,MACM,QADNA,MACM;;AAAA;;AAAA,mBAKFC,cAAIC,KAAJ,CAAUC,OAAOC,QAAP,CAAgBC,IAA1B,EAAgC,IAAhC,CALE;AAAA,yCAEJC,KAFI,CAGFC,IAHE;AAAA,MAGFA,IAHE,yCAGK,EAHL;;AAONJ,SAAOK,aAAP,GAAuB,UAACC,WAAD,EAAiB;AACtCN,WAAOO,MAAP,CAAcC,WAAd,CAA0B;AACxBF;AADwB,KAA1B,EAEG,GAFH;AAGD,GAJD;;AAMAN,SAAOS,gBAAP,CAAwB,SAAxB,EAAmC,iBAAc;AAAA,QAAXC,IAAW,SAAXA,IAAW;;AAC/C,QAAIA,IAAJ,EAAU;AAAA,UAENC,QAFM,GAGJD,IAHI,CAENC,QAFM;;;AAKR,UAAIA,YAAY,IAAhB,EAAsB;AAAA,0BAKhBb,cAAIC,KAAJ,CAAUY,QAAV,EAAoB,IAApB,CALgB;AAAA,YAElBR,KAFkB,eAElBA,KAFkB;AAAA,YAGlBS,MAHkB,eAGlBA,MAHkB;AAAA,YAIfC,SAJe;;AAMpB,YAAMC,MAAMhB,cAAIiB,MAAJ,4BACPF,SADO;AAEVV,4CACKA,KADL;AAEEa,mBAAUb,MAAMa,KAAhB,SAAyBZ;AAF3B,YAFU;AAMVQ,kBAAQK;AANE,WAAZ;AAQA,iCAAUH,GAAV,EAAkBjB,MAAlB,aAAkC,GAAlC,EAAuC,GAAvC;AACD;AACF;AACF,GAvBD;;AAyBA,MAAMqB,MAASrB,MAAT,SAAmBO,IAAnB,0BAAN;AACAJ,SAAOS,gBAAP,CAAwB,SAAxB,EAAmC,UAACU,CAAD,EAAO;AACxC,QAAIA,EAAED,GAAF,KAAUA,GAAV,IAAiBC,EAAEC,QAAnB,IAA+BD,EAAEC,QAAF,KAAe,EAAlD,EAAsD;AACpD,UAAMd,cAAca,EAAEC,QAAtB;AACApB,aAAOO,MAAP,CAAcC,WAAd,CAA0B;AACxBF;AADwB,OAA1B,EAEG,GAFH;AAGAe,mBAAaC,UAAb,CAAwBJ,GAAxB;AACD;AACF,GARD;AASA;AACAlB,SAAOO,MAAP,CAAcC,WAAd,CAA0B;AACxBe,iBAAa;AADW,GAA1B,EAEG,GAFH;AAGD,C;;kBAvDkB3B,oB","file":"index.js","sourcesContent":["import url from 'url';\nimport popWindow from '../popWindow';\n\nexport default class ProxyFrameController {\n  constructor({\n    prefix,\n  } = {}) {\n    const {\n      query: {\n        uuid = '',\n      },\n    } = url.parse(window.location.href, true);\n\n    window.oAuthCallback = (callbackUri) => {\n      window.parent.postMessage({\n        callbackUri,\n      }, '*');\n    };\n\n    window.addEventListener('message', ({ data }) => {\n      if (data) {\n        const {\n          oAuthUri,\n        } = data;\n\n        if (oAuthUri != null) {\n          const {\n            query,\n            search,\n            ...parsedUri,\n          } = url.parse(oAuthUri, true);\n          const uri = url.format({\n            ...parsedUri,\n            query: {\n              ...query,\n              state: `${query.state}-${uuid}`,\n            },\n            search: undefined,\n          });\n          popWindow(uri, `${prefix}-oauth`, 600, 600);\n        }\n      }\n    });\n\n    const key = `${prefix}-${uuid}-redirect-callbackUri`;\n    window.addEventListener('storage', (e) => {\n      if (e.key === key && e.newValue && e.newValue !== '') {\n        const callbackUri = e.newValue;\n        window.parent.postMessage({\n          callbackUri,\n        }, '*');\n        localStorage.removeItem(key);\n      }\n    });\n    // loaded\n    window.parent.postMessage({\n      proxyLoaded: true,\n    }, '*');\n  }\n}\n"]}