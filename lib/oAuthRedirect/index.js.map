{"version":3,"sources":["lib/oAuthRedirect/index.js"],"names":["callbackUri","window","location","href","opener","oAuthCallback","close","error","parsedUri","state","query","hash","split","slice","join","key","addEventListener","e","newValue","localStorage","setItem","setTimeout","removeItem"],"mappings":";;AAAA;;;;;;AAEA,CAAC,YAAM;AACL,MAAMA,cAAcC,OAAOC,QAAP,CAAgBC,IAApC;AACA,MAAI;AACF,QAAIF,OAAOG,MAAP,IAAiBH,OAAOG,MAAP,CAAcC,aAAnC,EAAkD;AAChDJ,aAAOG,MAAP,CAAcC,aAAd,CAA4BL,WAA5B;AACAC,aAAOK,KAAP;AACA;AACD;AACF,GAND,CAME,OAAOC,KAAP,EAAc;AACd;AACD;;AAED,MAAMC,YAAY,wBAAMR,WAAN,EAAmB,IAAnB,CAAlB;AACA,MAAMS,QAAQD,UAAUE,KAAV,CAAgBD,KAAhB,IAAyB,EAAvC;AACA,MAAME,OAAOF,MAAMG,KAAN,CAAY,GAAZ,EAAiBC,KAAjB,CAAuB,CAAvB,EAA0BC,IAA1B,CAA+B,GAA/B,CAAb;AACA,MAAIH,QAAQA,SAAS,EAArB,EAAyB;AACvB,QAAMI,MAASJ,IAAT,iBAAN;AACAV,WAAOe,gBAAP,CAAwB,SAAxB,EAAmC,UAACC,CAAD,EAAO;AACxC,UAAIA,EAAEF,GAAF,KAAUA,GAAV,KAAkB,CAACE,EAAEC,QAAH,IAAeD,EAAEC,QAAF,KAAe,EAAhD,CAAJ,EAAyD;AACvDjB,eAAOK,KAAP;AACD;AACF,KAJD;AAKAa,iBAAaC,OAAb,CAAqBL,GAArB,EAA0Bf,WAA1B;AACAqB,eAAW,YAAM;AACfF,mBAAaG,UAAb,CAAwBP,GAAxB;AACD,KAFD,EAEG,IAFH;AAGD;AACF,CA3BD","file":"index.js","sourcesContent":["import parse from 'url-parse';\n\n(() => {\n  const callbackUri = window.location.href;\n  try {\n    if (window.opener && window.opener.oAuthCallback) {\n      window.opener.oAuthCallback(callbackUri);\n      window.close();\n      return;\n    }\n  } catch (error) {\n    /* ignore error */\n  }\n\n  const parsedUri = parse(callbackUri, true);\n  const state = parsedUri.query.state || '';\n  const hash = state.split('-').slice(1).join('-');\n  if (hash && hash !== '') {\n    const key = `${hash}-callbackUri`;\n    window.addEventListener('storage', (e) => {\n      if (e.key === key && (!e.newValue || e.newValue === '')) {\n        window.close();\n      }\n    });\n    localStorage.setItem(key, callbackUri);\n    setTimeout(() => {\n      localStorage.removeItem(key);\n    }, 3000);\n  }\n})();\n"]}