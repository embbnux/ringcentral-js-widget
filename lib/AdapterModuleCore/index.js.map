{"version":3,"sources":["lib/AdapterModuleCore/index.js"],"names":["ALL_CALL_PATH","ACTIVE_CALL_PATH","AdapterModuleCore","deps","dep","optional","prefix","storageKey","messageTypes","baseMessageTypes","actionTypes","baseActionTypes","callingSettings","globalStorage","locale","presence","routerInteraction","webphone","callMonitor","userGuide","quickAccess","getGlobalStorageReducer","getDefaultGlobalStorageReducer","messageTransport","IframeMessageTransport","targetWindow","window","parent","options","_messageTypes","enumMap","_locale","ensureExist","_messageTransport","_presence","_router","_callingSettings","_webphone","_callMonitor","_userGuide","_quickAccess","_storageKey","_globalStorage","registerReducer","key","reducer","addSelector","ready","currentLocale","activeRingCalls","length","activeOnHoldCalls","localeReady","ringingCallsLength","onHoldCallsLength","ringCallsInfo","headerI18n","getString","numberOf","onHoldCallsInfo","currentCall","viewCalls","addListener","_onMessage","msg","store","subscribe","_onStateChange","pending","_shouldInit","dispatch","type","init","_pushAdapterState","_pushRingState","initSuccess","_pushPresence","_pushLocale","syncClosed","_syncClosed","closed","syncMinimized","_syncMinimized","minimized","syncSize","_syncSize","size","syncPosition","_syncPosition","position","presenceClicked","_onPresenceClicked","navigateToCurrentCall","_onNavigateToCurrentCall","navigateToViewCalls","_onNavigateToViewCalls","acitonTypes","callingMode","callingModes","Error","ringSession","ringSessionId","_ringSessionId","_postMessage","pushRingState","ringing","ringingSessions","sessions","filter","session","callStatus","direction","currentStartTime","activeCurrentCalls","startTime","_lastRingCallsLength","_lastOnHoldCallsLength","_lastCurrentStartTime","pushCalls","pushLocale","strings","_localeStrings","_showIncomingCallPage","_lastPath","currentPath","_lastShowIncomingCallPage","onCurrentCallPath","activeSessionId","pushOnCurrentCallPath","onAllCallsPath","pushOnAllCallsPath","status","telephonyStatus","_telephonyStatus","_lastDndStatus","dndStatus","_lastUserStatus","userStatus","_lastTelephonyStatus","pushPresence","_lastLocale","data","postMessage","_lastClosed","_lastMinimized","_lastPosition","translateX","translateY","minTranslateX","minTranslateY","pushAdapterState","showAdapter","push","started","dismiss","entered","exit","toggleMinimized","id","_selectors","localeStrings","state","moduleStatuses","getItem","RcModule","proxify"],"mappings":"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","file":"index.js","sourcesContent":["import formatMessage from 'format-message';\nimport RcModule from 'ringcentral-integration/lib/RcModule';\nimport { Module } from 'ringcentral-integration/lib/di';\nimport proxify from 'ringcentral-integration/lib/proxy/proxify';\nimport ensureExist from 'ringcentral-integration/lib/ensureExist';\nimport moduleStatuses from 'ringcentral-integration/enums/moduleStatuses';\nimport callingModes from 'ringcentral-integration/modules/CallingSettings/callingModes';\nimport { prefixEnum } from 'ringcentral-integration/lib/Enum';\nimport baseMessageTypes from '../AdapterCore/baseMessageTypes';\nimport baseActionTypes from './baseActionTypes';\nimport getDefaultGlobalStorageReducer from './getDefaultGlobalStorageReducer';\nimport IframeMessageTransport from '../IframeMessageTransport';\n\nimport headerI18n from '../../components/CallMonitorBar/i18n';\n\nconst ALL_CALL_PATH = '/calls';\nconst ACTIVE_CALL_PATH = '/calls/active';\n\n@Module({\n  deps: [\n    'CallingSettings',\n    'GlobalStorage',\n    'Locale',\n    'Presence',\n    'RouterInteraction',\n    'Storage',\n    'Webphone',\n    'CallMonitor',\n    { dep: 'UserGuide', optional: true },\n    { dep: 'QuickAccess', optional: true }\n  ]\n})\nexport default class AdapterModuleCore extends RcModule {\n  constructor({\n    prefix,\n    storageKey = 'adapterCore',\n    messageTypes = baseMessageTypes,\n    actionTypes = baseActionTypes,\n    callingSettings,\n    globalStorage,\n    locale,\n    presence,\n    routerInteraction,\n    webphone,\n    callMonitor,\n    userGuide,\n    quickAccess,\n    getGlobalStorageReducer = getDefaultGlobalStorageReducer,\n    messageTransport = new IframeMessageTransport({\n      targetWindow: window.parent,\n    }),\n    ...options\n  }) {\n    super({\n      prefix,\n      actionTypes,\n      ...options,\n    });\n\n    this._messageTypes = prefixEnum({ enumMap: messageTypes, prefix });\n    this._locale = this:: ensureExist(locale, 'locale');\n    this._messageTransport = this:: ensureExist(messageTransport, 'messageTransport');\n    this._presence = this:: ensureExist(presence, 'presence');\n    this._router = this:: ensureExist(routerInteraction, 'routerInteraction');\n    this._callingSettings = callingSettings;\n    this._webphone = webphone;\n    this._callMonitor = callMonitor;\n    this._userGuide = userGuide;\n    this._quickAccess = quickAccess;\n\n    this._storageKey = storageKey;\n    this._globalStorage = this:: ensureExist(globalStorage, 'globalStorage');\n\n    this._globalStorage.registerReducer({\n      key: this._storageKey,\n      reducer: getGlobalStorageReducer(this.actionTypes),\n    });\n\n    this.addSelector(\n      'localeStrings',\n      () => this._locale.ready,\n      () => this._locale.currentLocale,\n      () => this._callMonitor.activeRingCalls.length,\n      () => this._callMonitor.activeOnHoldCalls.length,\n      (localeReady, currentLocale, ringingCallsLength, onHoldCallsLength) => {\n        const ringCallsInfo = ringingCallsLength === 1 ?\n          formatMessage(headerI18n.getString('incomingCall', currentLocale), { numberOf: ringingCallsLength }) :\n          formatMessage(headerI18n.getString('incomingCalls', currentLocale), { numberOf: ringingCallsLength });\n        const onHoldCallsInfo = onHoldCallsLength === 1 ?\n          formatMessage(headerI18n.getString('callOnHold', currentLocale), { numberOf: onHoldCallsLength }) :\n          formatMessage(headerI18n.getString('callsOnHold', currentLocale), { numberOf: onHoldCallsLength });\n        return {\n          currentCall: headerI18n.getString('currentCall', currentLocale),\n          viewCalls: headerI18n.getString('viewCalls', currentLocale),\n          ringCallsInfo,\n          onHoldCallsInfo,\n        };\n      }\n    );\n  }\n  initialize() {\n    this._messageTransport.addListener(msg => this._onMessage(msg));\n    this.store.subscribe(() => this._onStateChange());\n  }\n  _shouldInit() {\n    return this.pending &&\n      this._globalStorage.ready &&\n      this._locale.ready &&\n      this._router.ready;\n  }\n  _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      this._pushAdapterState();\n      this._pushRingState();\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    }\n    this._pushPresence();\n    this._pushLocale();\n    this._pushRingState();\n  }\n  _onMessage(msg) {\n    if (msg) {\n      switch (msg.type) {\n        case this._messageTypes.syncClosed:\n          this._syncClosed(msg.closed);\n          break;\n        case this._messageTypes.syncMinimized:\n          this._syncMinimized(msg.minimized);\n          break;\n        case this._messageTypes.syncSize:\n          this._syncSize(msg.size);\n          break;\n        case this._messageTypes.syncPosition:\n          this._syncPosition(msg.position);\n          break;\n        case this._messageTypes.presenceClicked:\n          this._onPresenceClicked();\n          break;\n        case this._messageTypes.navigateToCurrentCall:\n          this._onNavigateToCurrentCall();\n          break;\n        case this._messageTypes.navigateToViewCalls:\n          this._onNavigateToViewCalls();\n          break;\n        default:\n          break;\n      }\n    }\n  }\n  @proxify\n  async _syncClosed(closed) {\n    this.store.dispatch({\n      type: this.actionTypes.syncClosed,\n      closed,\n    });\n  }\n  @proxify\n  async _syncMinimized(minimized) {\n    this.store.dispatch({\n      type: this.actionTypes.syncMinimized,\n      minimized,\n    });\n  }\n  @proxify\n  async _syncSize(size = {}) {\n    this.store.dispatch({\n      type: this.acitonTypes.syncSize,\n      size,\n    });\n  }\n  @proxify\n  async _syncPosition(position = {}) {\n    this.store.dispatch({\n      type: this.actionTypes.syncPosition,\n      position,\n    });\n  }\n\n  _pushRingState() {\n    if (!this.ready || !this._callingSettings) return;\n\n    const { callingMode } = this._callingSettings;\n    if (callingMode === callingModes.webphone) {\n      const webphone = this._webphone;\n      if (!webphone) {\n        throw new Error('webphone is a required dependency for monitoring WebRTC call');\n      }\n      if (webphone.ringSession && webphone.ringSessionId !== this._ringSessionId) {\n        this._ringSessionId = webphone.ringSessionId;\n        this._postMessage({\n          type: this._messageTypes.pushRingState,\n          ringing: true\n        });\n      }\n      // Check if ringing is over\n      if (this._ringSessionId) {\n        const ringingSessions = webphone.sessions.filter(session =>\n          session.callStatus === 'webphone-session-connecting' && session.direction === 'Inbound'\n        );\n        if (ringingSessions.length <= 0) {\n          this._postMessage({\n            type: this._messageTypes.pushRingState,\n            ringing: false\n          });\n          this._ringSessionId = null;\n        }\n      }\n      const ringingCallsLength = this._callMonitor.activeRingCalls.length;\n      const onHoldCallsLength = this._callMonitor.activeOnHoldCalls.length;\n      const currentStartTime = (\n        this._callMonitor.activeCurrentCalls &&\n        this._callMonitor.activeCurrentCalls.length > 0 &&\n        this._callMonitor.activeCurrentCalls[0].startTime) || 0;\n      if (\n        this._lastRingCallsLength !== ringingCallsLength ||\n        this._lastOnHoldCallsLength !== onHoldCallsLength ||\n        this._lastCurrentStartTime !== currentStartTime\n      ) {\n        this._lastRingCallsLength = ringingCallsLength;\n        this._lastOnHoldCallsLength = onHoldCallsLength;\n        this._lastCurrentStartTime = currentStartTime;\n        this._postMessage({\n          type: this._messageTypes.pushCalls,\n          ringingCallsLength,\n          onHoldCallsLength,\n          currentStartTime,\n        });\n        this._postMessage({\n          type: this._messageTypes.pushLocale,\n          strings: this._localeStrings\n        });\n      }\n      this._showIncomingCallPage = !!(\n        this._webphone && this._webphone.ringSession && !this._webphone.ringSession.minimized\n      );\n      if (this._lastPath !== this._router.currentPath ||\n        this._lastShowIncomingCallPage !== this._showIncomingCallPage\n      ) {\n        this._lastPath = this._router.currentPath;\n        this._lastShowIncomingCallPage = this._showIncomingCallPage;\n        const onCurrentCallPath = (\n          (this._router.currentPath === ACTIVE_CALL_PATH ||\n            this._router.currentPath === `${ACTIVE_CALL_PATH}/${this._webphone.activeSessionId}`) &&\n          !this._showIncomingCallPage\n        );\n        if (\n          this.onCurrentCallPath !== onCurrentCallPath ||\n          this._lastShowIncomingCallPage !== this._showIncomingCallPage\n        ) {\n          this.onCurrentCallPath = onCurrentCallPath;\n          this._lastShowIncomingCallPage = this._showIncomingCallPage;\n          this._postMessage({\n            type: this._messageTypes.pushOnCurrentCallPath,\n            onCurrentCallPath,\n          });\n        }\n        const onAllCallsPath = (\n          this._router.currentPath === ALL_CALL_PATH &&\n          !this._showIncomingCallPage\n        );\n        if (\n          this.onAllCallsPath !== onAllCallsPath\n        ) {\n          this.onAllCallsPath = onAllCallsPath;\n          this._postMessage({\n            type: this._messageTypes.pushOnAllCallsPath,\n            onAllCallsPath,\n          });\n        }\n      }\n    } else {\n      const status = this._presence.telephonyStatus;\n      if (this._presence.telephonyStatus !== this._telephonyStatus) {\n        this._postMessage({\n          type: this._messageTypes.pushRingState,\n          ringing: status === 'Ringing'\n        });\n        this._telephonyStatus = status;\n      }\n    }\n  }\n\n  _pushPresence() {\n    if (\n      this.ready &&\n      (\n        this._lastDndStatus !== this._presence.dndStatus ||\n        this._lastUserStatus !== this._presence.userStatus ||\n        this._lastTelephonyStatus !== this._presence.telephonyStatus\n      )\n    ) {\n      this._lastDndStatus = this._presence.dndStatus;\n      this._lastUserStatus = this._presence.userStatus;\n      this._lastTelephonyStatus = this._presence.telephonyStatus;\n      this._postMessage({\n        type: this._messageTypes.pushPresence,\n        telephonyStatus: this._presence.telephonyStatus,\n        userStatus: this._presence.userStatus,\n        dndStatus: this._presence.dndStatus,\n      });\n    }\n  }\n\n  get localeStrings() {\n    return {};\n  }\n\n  _pushLocale() {\n    if (\n      this.ready &&\n      this._locale.ready &&\n      this._lastLocale !== this._locale.currentLocale\n    ) {\n      this._lastLocale = this._locale.currentLocale;\n      this._postMessage({\n        type: this._messageTypes.pushLocale,\n        locale: this._locale.currentLocale,\n        strings: this._localeStrings,\n      });\n    }\n  }\n\n  _postMessage(data) {\n    this._messageTransport.postMessage(data);\n  }\n\n  _pushAdapterState() {\n    if (\n      this.ready &&\n      (\n        this._lastDndStatus !== this._presence.dndStatus ||\n        this._lastUserStatus !== this._presence.userStatus ||\n        this._lastTelephonyStatus !== this._presence.telephonyStatus ||\n        this._lastClosed !== this.closed ||\n        this._lastMinimized !== this.minimized ||\n        this._lastPosition.translateX !== this.position.translateX ||\n        this._lastPosition.translateY !== this.position.translateY ||\n        this._lastPosition.minTranslateX !== this.position.minTranslateX ||\n        this._lastPosition.minTranslateY !== this.position.minTranslateY\n      )\n    ) {\n      this._lastDndStatus = this._presence.dndStatus;\n      this._lastUserStatus = this._presence.userStatus;\n      this._lastTelephonyStatus = this._presence.telephonyStatus;\n      this._lastClosed = this.closed;\n      this._lastMinimized = this.minimized;\n      this._lastPosition = this.position;\n      this._postMessage({\n        type: this._messageTypes.pushAdapterState,\n        size: this.size,\n        minimized: this.minimized,\n        closed: this.closed,\n        position: this.position,\n        telephonyStatus: this._presence.telephonyStatus,\n        userStatus: this._presence.userStatus,\n        dndStatus: this._presence.dndStatus,\n      });\n    }\n  }\n  @proxify\n  async _onPresenceClicked() {\n    if (this.minimized) {\n      this.showAdapter();\n    }\n    this._router.push('/settings?showPresenceSettings=1');\n  }\n\n  @proxify\n  async showAdapter() {\n    this.store.dispatch({\n      type: this.actionTypes.showAdapter,\n    });\n  }\n\n  @proxify\n  async _onNavigateToCurrentCall() {\n    this._router.push(ACTIVE_CALL_PATH);\n    if (this._userGuide && this._userGuide.started) {\n      this._userGuide.dismiss();\n    }\n    if (this._quickAccess && this._quickAccess.entered) {\n      this._quickAccess.exit();\n    }\n    if (this._webphone && this._webphone.ringSession && !this._webphone.ringSession.minimized) {\n      this._webphone.toggleMinimized(this._webphone.ringSession.id);\n    }\n  }\n\n  @proxify\n  async _onNavigateToViewCalls() {\n    this._router.push(ALL_CALL_PATH);\n    if (this._userGuide && this._userGuide.started) {\n      this._userGuide.dismiss();\n    }\n    if (this._quickAccess && this._quickAccess.entered) {\n      this._quickAccess.exit();\n    }\n    if (this._webphone && this._webphone.ringSession && !this._webphone.ringSession.minimized) {\n      this._webphone.toggleMinimized(this._webphone.ringSession.id);\n    }\n  }\n\n  get _localeStrings() {\n    return this._selectors.localeStrings();\n  }\n\n  get status() {\n    return this.state.status;\n  }\n  get ready() {\n    return this.status === moduleStatuses.ready;\n  }\n\n  get pending() {\n    return this.status === moduleStatuses.pending;\n  }\n\n  get minimized() {\n    return this._globalStorage.getItem(this._storageKey).minimized;\n  }\n  get closed() {\n    return this._globalStorage.getItem(this._storageKey).closed;\n  }\n  get size() {\n    return this._globalStorage.getItem(this._storageKey).size;\n  }\n  get position() {\n    return this._globalStorage.getItem(this._storageKey).position;\n  }\n}\n"]}