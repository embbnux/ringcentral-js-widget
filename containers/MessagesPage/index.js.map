{"version":3,"sources":["containers/MessagesPage/index.js"],"names":["MessageSpiner","spinerContainer","MessagesPage","props","onSearchChange","e","value","currentTarget","updateSearchingString","searchMessage","bind","getMessageRecipientNames","message","recipients","length","getRecipientsList","map","recipient","phoneNumber","extensionNumber","matchedNames","matcherName","matcher","name","join","formatPhone","searchText","searchNumber","recipientName","indexOf","toLowerCase","searchString","searchingString","updateSearchResults","trim","replace","searchTextResults","searchMessagesText","reverse","searchContactresults","allMessages","filter","isMatchRecipients","results","searchMap","addSearchResultToResult","conversationId","push","forEach","searchingResults","getString","formatDateTime","messages","loadNextPageMessages","showSpinner","root","content","renderMessageList","propTypes","func","isRequired","isLoadingNextPage","bool","string","mapStateToProps","state","currentLocale","locale","normalizedMessages","messageStore","conversations","ready","contactMatcher","extensionInfo","dateTimeIntl","lastUpdatedAt","mapDispatchToProps","dispatch","utcString","areaCode","regionSettings","countryCode","myExtensionNumber"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component, PropTypes } from 'react';\nimport { connect } from 'react-redux';\n\nimport formatNumber from 'ringcentral-integration/lib/formatNumber';\nimport { getRecipients } from 'ringcentral-integration/lib/messageHelper';\n\nimport Spinner from '../../components/Spinner';\nimport Panel from '../../components/Panel';\n\nimport MessageList from '../../components/MessageList';\nimport SearchInput from '../../components/SearchInput';\n\nimport styles from './styles.scss';\nimport i18n from './i18n';\n\nfunction MessageSpiner() {\n  return (\n    <div className={styles.spinerContainer}>\n      <Spinner />\n    </div>\n  );\n}\n\nclass MessagesPage extends Component {\n  constructor(props) {\n    super(props);\n    this.onSearchChange = (e) => {\n      const value = e.currentTarget.value;\n      this.props.updateSearchingString(value);\n    };\n\n    this.searchMessage = this.searchMessage.bind(this);\n    this.getMessageRecipientNames = this.getMessageRecipientNames.bind(this);\n  }\n\n  getMessageRecipientNames(message) {\n    let recipients = message.recipients;\n    if (!recipients || recipients.length === 0) {\n      recipients = this.props.getRecipientsList(message);\n    }\n    return recipients.map((recipient) => {\n      const phoneNumber = recipient.phoneNumber || recipient.extensionNumber;\n      if (recipient.matchedNames) {\n        const matcherName = recipient.matchedNames.map(matcher => matcher.name).join('&');\n        if (matcherName.length > 0) {\n          return matcherName;\n        }\n        return this.props.formatPhone(phoneNumber);\n      }\n      if (recipient.name) {\n        return recipient.name;\n      }\n      return this.props.formatPhone(phoneNumber);\n    });\n  }\n\n  isMatchRecipients(message, searchText, searchNumber) {\n    const recipients = this.props.getRecipientsList(message);\n    for (const recipient of recipients) {\n      const phoneNumber = recipient.phoneNumber || recipient.extensionNumber;\n      let recipientName = null;\n      if (phoneNumber) {\n        if (searchNumber && searchNumber.length > 0 && phoneNumber.indexOf(searchNumber) >= 0) {\n          return true;\n        }\n        if (recipient.matchedNames) {\n          const matcherName = recipient.matchedNames.map(matcher => matcher.name).join('&');\n          if (matcherName.length > 0) {\n            recipientName = matcherName;\n          } else {\n            recipientName = phoneNumber;\n          }\n        }\n      }\n      if (!recipientName && recipient.name) {\n        recipientName = recipient.name;\n      }\n      if (recipientName && recipientName.toLowerCase().indexOf(searchText) >= 0) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  searchMessage() {\n    const searchString = this.props.searchingString;\n    if (searchString.length < 3) {\n      this.props.updateSearchResults([]);\n      return;\n    }\n    const searchText = searchString.toLowerCase().trim();\n    let searchNumber = searchString.replace(/[^\\d]/g, '');\n    if (searchString.length !== searchNumber.length && searchNumber.length < 2) {\n      searchNumber = null;\n    }\n    const searchTextResults = this.props.searchMessagesText(searchText).reverse();\n    const searchContactresults = this.props.allMessages.filter(message =>\n      this.isMatchRecipients(message, searchText, searchNumber)\n    ).reverse();\n    const results = [];\n    const searchMap = {};\n    const addSearchResultToResult = (message) => {\n      if (searchMap[message.conversationId]) {\n        return;\n      }\n      searchMap[message.conversationId] = 1;\n      results.push(message);\n    };\n    searchContactresults.forEach(addSearchResultToResult);\n    searchTextResults.forEach(addSearchResultToResult);\n    this.props.updateSearchResults(results);\n  }\n\n  renderMessageList() {\n    if (this.props.searchingString.length >= 3) {\n      return (\n        <MessageList\n          messages={this.props.searchingResults}\n          loadNextPageMessages={() => null}\n          loading={false}\n          placeholder={i18n.getString('noSearchResults')}\n          formatDateTime={this.props.formatDateTime}\n          getMessageRecipientNames={this.getMessageRecipientNames}\n        />\n      );\n    }\n    return (\n      <MessageList\n        messages={this.props.messages}\n        loadNextPageMessages={this.props.loadNextPageMessages}\n        placeholder={i18n.getString('noMessages')}\n        formatDateTime={this.props.formatDateTime}\n        getMessageRecipientNames={this.getMessageRecipientNames}\n      />\n    );\n  }\n\n  render() {\n    const showSpinner = this.props.showSpinner;\n    if (showSpinner) {\n      return (\n        <div className={styles.root}>\n          <MessageSpiner />\n        </div>\n      );\n    }\n    return (\n      <div className={styles.content}>\n        <SearchInput\n          value={this.props.searchingString}\n          onChange={this.onSearchChange}\n          onKeyUp={this.searchMessage}\n          maxLength={30}\n          placeholder={i18n.getString('search')}\n        />\n        <Panel>\n          {this.renderMessageList()}\n        </Panel>\n      </div>\n    );\n  }\n}\n\nMessagesPage.propTypes = {\n  messages: MessageList.propTypes.messages,\n  allMessages: MessageList.propTypes.messages,\n  searchingResults: MessageList.propTypes.messages,\n  loadNextPageMessages: PropTypes.func.isRequired,\n  updateSearchingString: PropTypes.func.isRequired,\n  isLoadingNextPage: PropTypes.bool,\n  showSpinner: PropTypes.bool.isRequired,\n  searchingString: PropTypes.string.isRequired,\n  formatDateTime: PropTypes.func.isRequired,\n  formatPhone: PropTypes.func.isRequired,\n  getRecipientsList: PropTypes.func.isRequired,\n  searchMessagesText: PropTypes.func.isRequired,\n  updateSearchResults: PropTypes.func.isRequired,\n};\n\nfunction mapStateToProps(state, props) {\n  return ({\n    currentLocale: props.locale.currentLocale,\n    messages: props.messages.normalizedMessages,\n    allMessages: props.messageStore.conversations,\n    showSpinner: (\n      !props.messages.ready ||\n      (props.contactMatcher && !props.contactMatcher.ready) ||\n      !props.extensionInfo.ready ||\n      !props.dateTimeIntl.ready\n    ),\n    lastUpdatedAt: props.messages.lastUpdatedAt,\n    searchingString: props.messages.searchingString,\n    searchingResults: props.messages.searchingResults,\n  });\n}\n\nfunction mapDispatchToProps(dispatch, props) {\n  return {\n    loadNextPageMessages: props.messages.loadNextPageMessages,\n    updateSearchingString: props.messages.updateSearchingString,\n    updateSearchResults: props.messages.updateSearchResults,\n    formatDateTime: utcString => props.dateTimeIntl.formatDateTime({\n      utcString\n    }),\n    formatPhone: phoneNumber => formatNumber({\n      phoneNumber,\n      areaCode: props.regionSettings.areaCode,\n      countryCode: props.regionSettings.countryCode,\n    }),\n    getRecipientsList: message => getRecipients({\n      message,\n      myExtensionNumber: props.extensionInfo.extensionNumber,\n    }),\n    searchMessagesText: searchText =>\n      props.messageStore.searchMessagesText(searchText),\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MessagesPage);\n"]}