{"version":3,"sources":["containers/ConversationPage/index.js"],"names":["ConversationPage","formatPhone","props","formatNumber","formatDateTime","changeDefaultRecipient","getRecipientName","recipient","getMatcherContactList","loadConversation","unloadConversation","phoneNumber","extensionNumber","getMatcherContactName","matcherName","name","id","conversationId","loadConversationById","currentLocale","messages","recipients","showSpinner","replyToReceivers","sendButtonDisabled","propTypes","string","isRequired","bool","func","defaultProps","childContextTypes","mapStateToProps","state","locale","params","conversation","pushing","dateTimeFormat","ready","contactMatcher","regionSettings","mapDispatchToProps","dispatch","undefined","matcherNames","dataMapping","length","map","matcher","join","utcTimestamp","areaCode","countryCode"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component, PropTypes } from 'react';\nimport { connect } from 'react-redux';\n\nimport formatNumber from 'ringcentral-integration/lib/formatNumber';\n\nimport ConversationPanel from '../../components/ConversationPanel';\n\nclass ConversationPage extends Component {\n  getChildContext() {\n    return {\n      formatPhone: this.props.formatNumber,\n      formatDateTime: this.props.formatDateTime,\n      changeDefaultRecipient: this.props.changeDefaultRecipient,\n      getRecipientName: recipient => (this.getRecipientName(recipient)),\n      getMatcherContactList: this.props.getMatcherContactList,\n    };\n  }\n\n  componentDidMount() {\n    this.loadConversation();\n  }\n\n  componentWillUnmount() {\n    this.props.unloadConversation();\n  }\n\n  getRecipientName(recipient) {\n    const phoneNumber = recipient.phoneNumber || recipient.extensionNumber;\n    if (phoneNumber && this.props.getMatcherContactName) {\n      const matcherName = this.props.getMatcherContactName(phoneNumber);\n      if (matcherName) {\n        return matcherName;\n      }\n      return this.props.formatNumber(phoneNumber);\n    }\n    if (recipient.name) {\n      return recipient.name;\n    }\n    return this.props.formatNumber(phoneNumber);\n  }\n\n  loadConversation() {\n    const id = this.props.conversationId;\n    this.props.loadConversationById(id);\n  }\n\n  render() {\n    return (\n      <ConversationPanel\n        conversationId={this.props.conversationId}\n        currentLocale={this.props.currentLocale}\n        messages={this.props.messages}\n        recipients={this.props.recipients}\n        showSpinner={this.props.showSpinner}\n        replyToReceivers={this.props.replyToReceivers}\n        sendButtonDisabled={this.props.sendButtonDisabled}\n      />\n    );\n  }\n}\n\nConversationPage.propTypes = {\n  conversationId: PropTypes.string.isRequired,\n  currentLocale: PropTypes.string.isRequired,\n  sendButtonDisabled: PropTypes.bool.isRequired,\n  showSpinner: PropTypes.bool.isRequired,\n  messages: ConversationPanel.propTypes.messages,\n  recipients: ConversationPanel.propTypes.recipients,\n  replyToReceivers: PropTypes.func.isRequired,\n  unloadConversation: PropTypes.func.isRequired,\n  loadConversationById: PropTypes.func.isRequired,\n  changeDefaultRecipient: PropTypes.func.isRequired,\n  formatNumber: PropTypes.func.isRequired,\n  formatDateTime: PropTypes.func.isRequired,\n  getMatcherContactName: PropTypes.func,\n  getMatcherContactList: PropTypes.func,\n};\n\nConversationPage.defaultProps = {\n  getMatcherContactName: null,\n  getMatcherContactList: () => [],\n};\n\nConversationPage.childContextTypes = {\n  formatPhone: PropTypes.func.isRequired,\n  formatDateTime: PropTypes.func.isRequired,\n  getRecipientName: PropTypes.func.isRequired,\n  changeDefaultRecipient: PropTypes.func.isRequired,\n  getMatcherContactList: PropTypes.func.isRequired,\n};\n\nfunction mapStateToProps(state, props) {\n  return ({\n    currentLocale: props.locale.currentLocale,\n    conversationId: props.params.conversationId,\n    sendButtonDisabled: props.conversation.pushing,\n    showSpinner: (\n      !props.dateTimeFormat.ready ||\n      (props.contactMatcher && !props.contactMatcher.ready) ||\n      !props.conversation.ready ||\n      !props.regionSettings.ready\n    ),\n    recipients: props.conversation.recipients,\n    messages: props.conversation.messages,\n  });\n}\n\nfunction mapDispatchToProps(dispatch, props) {\n  let getMatcherContactName = undefined;\n  let getMatcherContactList = undefined;\n  if (props.contactMatcher && props.contactMatcher.ready) {\n    getMatcherContactList = (phoneNumber) => {\n      const matcherNames = props.contactMatcher.dataMapping[phoneNumber];\n      if (matcherNames && matcherNames.length > 0) {\n        return matcherNames.map(matcher => matcher.name);\n      }\n      return [];\n    };\n\n    getMatcherContactName = (phoneNumber) => {\n      const matcherNames = getMatcherContactList(phoneNumber);\n      if (matcherNames && matcherNames.length > 0) {\n        return matcherNames.join('&');\n      }\n      return null;\n    };\n  }\n\n  return {\n    replyToReceivers: props.conversation.replyToReceivers,\n    changeDefaultRecipient: props.conversation.changeDefaultRecipient,\n    unloadConversation: () => props.conversation.unloadConversation(),\n    loadConversationById: id => props.conversation.loadConversationById(id),\n    formatDateTime: props.formatDateTime ||\n    (utcTimestamp => props.dateTimeFormat.formatDateTime({\n      utcTimestamp,\n    })),\n    formatNumber: phoneNumber => formatNumber({\n      phoneNumber,\n      areaCode: props.regionSettings.areaCode,\n      countryCode: props.regionSettings.countryCode,\n    }),\n    getMatcherContactName,\n    getMatcherContactList,\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ConversationPage);\n"]}