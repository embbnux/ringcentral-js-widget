{"version":3,"sources":["containers/ConversationPage/index.js"],"names":["ConversationPage","formatPhone","props","formatNumber","formatDateTime","changeDefaultRecipient","changeMatchedNames","getRecipientName","recipient","getMatcherContactList","loadConversation","unloadConversation","phoneNumber","extensionNumber","getMatcherContactName","matcherName","name","id","conversationId","loadConversationById","currentLocale","messages","recipients","showSpinner","replyToReceivers","sendButtonDisabled","propTypes","string","isRequired","bool","func","defaultProps","childContextTypes","mapStateToProps","state","locale","params","conversation","pushing","dateTimeFormat","ready","contactMatcher","regionSettings","mapDispatchToProps","dispatch","matcherNames","dataMapping","length","map","matcher","join","utcTimestamp","areaCode","countryCode"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component, PropTypes } from 'react';\nimport { connect } from 'react-redux';\n\nimport formatNumber from 'ringcentral-integration/lib/formatNumber';\n\nimport ConversationPanel from '../../components/ConversationPanel';\n\nclass ConversationPage extends Component {\n  getChildContext() {\n    return {\n      formatPhone: this.props.formatNumber,\n      formatDateTime: this.props.formatDateTime,\n      changeDefaultRecipient: this.props.changeDefaultRecipient,\n      changeMatchedNames: this.props.changeMatchedNames,\n      getRecipientName: recipient => (this.getRecipientName(recipient)),\n      getMatcherContactList: this.props.getMatcherContactList,\n    };\n  }\n\n  componentDidMount() {\n    this.loadConversation();\n  }\n\n  componentWillUnmount() {\n    this.props.unloadConversation();\n  }\n\n  getRecipientName(recipient) {\n    const phoneNumber = recipient.phoneNumber || recipient.extensionNumber;\n    if (phoneNumber && this.props.getMatcherContactName) {\n      const matcherName = this.props.getMatcherContactName(phoneNumber);\n      if (matcherName) {\n        return matcherName;\n      }\n      return this.props.formatNumber(phoneNumber);\n    }\n    if (recipient.name) {\n      return recipient.name;\n    }\n    return this.props.formatNumber(phoneNumber);\n  }\n\n  loadConversation() {\n    const id = this.props.conversationId;\n    this.props.loadConversationById(id);\n  }\n\n  render() {\n    return (\n      <ConversationPanel\n        conversationId={this.props.conversationId}\n        currentLocale={this.props.currentLocale}\n        messages={this.props.messages}\n        recipients={this.props.recipients}\n        showSpinner={this.props.showSpinner}\n        replyToReceivers={this.props.replyToReceivers}\n        sendButtonDisabled={this.props.sendButtonDisabled}\n      />\n    );\n  }\n}\n\nConversationPage.propTypes = {\n  conversationId: PropTypes.string.isRequired,\n  currentLocale: PropTypes.string.isRequired,\n  sendButtonDisabled: PropTypes.bool.isRequired,\n  showSpinner: PropTypes.bool.isRequired,\n  messages: ConversationPanel.propTypes.messages,\n  recipients: ConversationPanel.propTypes.recipients,\n  replyToReceivers: PropTypes.func.isRequired,\n  unloadConversation: PropTypes.func.isRequired,\n  loadConversationById: PropTypes.func.isRequired,\n  changeDefaultRecipient: PropTypes.func.isRequired,\n  formatNumber: PropTypes.func.isRequired,\n  formatDateTime: PropTypes.func.isRequired,\n  getMatcherContactName: PropTypes.func,\n  getMatcherContactList: PropTypes.func,\n  changeMatchedNames: PropTypes.func.isRequired,\n};\n\nConversationPage.defaultProps = {\n  getMatcherContactName: null,\n  getMatcherContactList: () => [],\n};\n\nConversationPage.childContextTypes = {\n  formatPhone: PropTypes.func.isRequired,\n  formatDateTime: PropTypes.func.isRequired,\n  getRecipientName: PropTypes.func.isRequired,\n  changeDefaultRecipient: PropTypes.func.isRequired,\n  changeMatchedNames: PropTypes.func.isRequired,\n  getMatcherContactList: PropTypes.func.isRequired,\n};\n\nfunction mapStateToProps(state, props) {\n  return ({\n    currentLocale: props.locale.currentLocale,\n    conversationId: props.params.conversationId,\n    sendButtonDisabled: props.conversation.pushing,\n    showSpinner: (\n      !props.dateTimeFormat.ready ||\n      (props.contactMatcher && !props.contactMatcher.ready) ||\n      !props.conversation.ready ||\n      !props.regionSettings.ready\n    ),\n    recipients: props.conversation.recipients,\n    messages: props.conversation.messages,\n  });\n}\n\nfunction mapDispatchToProps(dispatch, props) {\n  let getMatcherContactName;\n  let getMatcherContactList;\n  if (props.contactMatcher && props.contactMatcher.ready) {\n    getMatcherContactList = (phoneNumber) => {\n      const matcherNames = props.contactMatcher.dataMapping[phoneNumber];\n      if (matcherNames && matcherNames.length > 0) {\n        return matcherNames.map(matcher => matcher.name);\n      }\n      return [];\n    };\n\n    getMatcherContactName = (phoneNumber) => {\n      const matcherNames = getMatcherContactList(phoneNumber);\n      if (matcherNames && matcherNames.length > 0) {\n        return matcherNames.join('&');\n      }\n      return null;\n    };\n  }\n\n  return {\n    replyToReceivers: props.conversation.replyToReceivers,\n    changeDefaultRecipient: props.conversation.changeDefaultRecipient,\n    changeMatchedNames: props.conversation.changeMatchedNames,\n    unloadConversation: () => props.conversation.unloadConversation(),\n    loadConversationById: id => props.conversation.loadConversationById(id),\n    formatDateTime: props.formatDateTime ||\n    (utcTimestamp => props.dateTimeFormat.formatDateTime({\n      utcTimestamp,\n    })),\n    formatNumber: phoneNumber => formatNumber({\n      phoneNumber,\n      areaCode: props.regionSettings.areaCode,\n      countryCode: props.regionSettings.countryCode,\n    }),\n    getMatcherContactName,\n    getMatcherContactList,\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ConversationPage);\n"]}