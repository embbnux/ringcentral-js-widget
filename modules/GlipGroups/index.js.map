{"version":3,"sources":["modules/GlipGroups/index.js"],"names":["glipGroupRegExp","subscriptionFilter","DEFAULT_PER_PAGE","DEFAULT_TTL","DEFAULT_RETRY","DEFAULT_RECORD_COUNT_PER_REQ","DEFAULT_PRELOAD_POSTS_DELAY_TTL","formatGroup","group","personsMap","postsMap","ownerId","id","detailMembers","members","forEach","memberId","push","isMe","newGroup","updatedTime","Date","lastModifiedTime","getTime","latestPost","creator","creatorId","postCreationTime","creationTime","getUniqueMemberIds","groups","memberIds","memberIdsMap","searchPosts","searchFilter","posts","result","post","text","toLowerCase","indexOf","mentions","length","mentionNames","map","m","name","join","GlipGroups","deps","dep","optional","auth","subscription","client","tabManager","glipPersons","glipPosts","storage","rolesAndPermissions","connectivityMonitor","timeToRetry","ttl","polling","disableCache","perPage","recordCountPerReq","preloadPosts","preloadPostsDelayTtl","options","actionTypes","_auth","ensureExist","_client","_subscription","_rolesAndPermissions","_connectivityMonitor","_glipPersons","_glipPosts","_tabManager","_ttl","_timeToRetry","_polling","_perPage","_recordCountPerReq","_preloadPosts","_preloadedPosts","_preloadPostsDelayTtl","_promise","_lastMessage","_subscriptionFilters","_storage","_dataStorageKey","_timestampStorageKey","_reducer","registerReducer","key","reducer","timestamp","data","addNewPostListener","onNewPost","store","subscribe","_onStateChange","_shouldInit","dispatch","type","init","_init","_isDataReady","initSuccess","_onDataReady","_shouldReset","_clearTimeout","resetSuccess","_shouldSubscribe","_processSubscription","ready","_connectivity","connectivity","fetchData","_preloadGroupPosts","loggedIn","_readyCheckFn","pending","message","loadPersons","groupMemberIds","test","event","body","eventType","removeGroup","updateGroup","loadPosts","active","status","moduleStatuses","initializing","_hasPermission","_shouldFetch","console","error","_retry","_startPolling","_subscriptionHandleFn","force","slice","fetchPosts","readTimeMap","updateReadTime","now","pageNumber","updateFilter","groupId","lastGroupId","currentGroupId","lastGroupPosts","currentGroupPosts","updateCurrentGroupId","currentGroup","glip","list","recordCount","fetch","_fetchFunction","fetchSuccess","fetchError","_fetchData","personId","isPublic","description","state","getItem","hasGlipPermission","Pollable","proxify","getter","allGroups","filterString","filter","groupUsernames","firstName","lastName","filteredGroups","sortedGroups","sort","a","b","noTeamGroups","g","find","undefined","reversePosts","reverse","sentByMe","readTime","unread","groupsWithUnread","reduce"],"mappings":"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","file":"index.js","sourcesContent":["import { createSelector } from 'reselect';\n\nimport { Module } from '../../lib/di';\nimport Pollable from '../../lib/Pollable';\nimport isBlank from '../../lib/isBlank';\nimport sleep from '../../lib/sleep';\nimport moduleStatuses from '../../enums/moduleStatuses';\nimport ensureExist from '../../lib/ensureExist';\nimport getter from '../../lib/getter';\nimport proxify from '../../lib/proxy/proxify';\n\nimport getReducer, {\n  getDataReducer,\n  getTimestampReducer,\n} from './getReducer';\nimport actionTypes from './actionTypes';\n\nconst glipGroupRegExp = /glip\\/groups$/;\nconst subscriptionFilter = '/glip/groups';\n\nconst DEFAULT_PER_PAGE = 20;\nconst DEFAULT_TTL = 30 * 60 * 1000;\nconst DEFAULT_RETRY = 62 * 1000;\nconst DEFAULT_RECORD_COUNT_PER_REQ = 250;\nconst DEFAULT_PRELOAD_POSTS_DELAY_TTL = 800;\n\nfunction formatGroup(group, personsMap, postsMap = {}, ownerId) {\n  if (!group || !group.id) {\n    return {};\n  }\n  const detailMembers = [];\n  if (group.members) {\n    group.members.forEach((memberId) => {\n      if (personsMap[memberId]) {\n        detailMembers.push({\n          ...personsMap[memberId],\n          isMe: ownerId === memberId,\n        });\n      }\n    });\n  }\n  const newGroup = {\n    ...group,\n    detailMembers,\n    updatedTime: (new Date(group.lastModifiedTime)).getTime(),\n  };\n  const latestPost =\n    postsMap[group.id] && postsMap[group.id][0];\n  if (latestPost) {\n    newGroup.latestPost = {\n      ...latestPost,\n      creator: personsMap[latestPost.creatorId],\n    };\n    const postCreationTime = (new Date(latestPost.creationTime)).getTime();\n    if (postCreationTime > newGroup.updatedTime) {\n      newGroup.updatedTime = postCreationTime;\n    }\n  }\n  return newGroup;\n}\n\nfunction getUniqueMemberIds(groups) {\n  const memberIds = [];\n  const memberIdsMap = {};\n  groups.forEach((group) => {\n    group.members.forEach((memberId) => {\n      if (memberIdsMap[memberId]) {\n        return;\n      }\n      memberIdsMap[memberId] = true;\n      memberIds.push(memberId);\n    });\n  });\n  return memberIds;\n}\n\nfunction searchPosts(searchFilter, posts) {\n  let result = false;\n  for (const post of posts) {\n    if (post.text && post.text.toLowerCase().indexOf(searchFilter) > -1) {\n      result = true;\n      break;\n    }\n    if (post.mentions && post.mentions.length > 0) {\n      const mentionNames = post.mentions.map(m => m.name).join(' ').toLowerCase();\n      if (mentionNames.indexOf(searchFilter) > -1) {\n        result = true;\n        break;\n      }\n    }\n  }\n  return result;\n}\n\n/**\n * @class\n * @description Accound info managing module.\n */\n@Module({\n  deps: [\n    'Auth',\n    'Client',\n    'Subscription',\n    'RolesAndPermissions',\n    { dep: 'ConnectivityMonitor', optional: true },\n    { dep: 'Storage', optional: true },\n    { dep: 'TabManager', optional: true },\n    { dep: 'GlipPersons', optional: true },\n    { dep: 'GlipPosts', optional: true },\n    { dep: 'GLipGroupsOptions', optional: true }\n  ]\n})\nexport default class GlipGroups extends Pollable {\n  /**\n   * @constructor\n   * @param {Object} params - params object\n   * @param {Client} params.client - client module instance\n   * @param {Auth} params.auth - auth module instance\n   * @param {RolesAndPermissions} params.rolesAndPermissions - rolesAndPermission module instance\n   * @param {Subscription} params.subscription - subscription module instance\n   * @param {TabManager} params.tabManager - tabManager module instance\n   * @param {GlipPersons} params.glipPersons - glipPersons module instance\n   * @param {GlipPosts} params.glipPosts - glipPosts module instance\n   * @param {Storage} params.storage - storage module instance\n   */\n  constructor({\n    auth,\n    subscription,\n    client,\n    tabManager,\n    glipPersons,\n    glipPosts,\n    storage,\n    rolesAndPermissions,\n    connectivityMonitor,\n    timeToRetry = DEFAULT_RETRY,\n    ttl = DEFAULT_TTL,\n    polling = false,\n    disableCache = false,\n    perPage = DEFAULT_PER_PAGE,\n    recordCountPerReq = DEFAULT_RECORD_COUNT_PER_REQ,\n    preloadPosts = true,\n    preloadPostsDelayTtl = DEFAULT_PRELOAD_POSTS_DELAY_TTL,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes,\n    });\n    this._auth = this::ensureExist(auth, 'auth');\n    this._client = this::ensureExist(client, 'client');\n    this._subscription = this::ensureExist(subscription, 'subscription');\n    this._rolesAndPermissions = this::ensureExist(rolesAndPermissions, 'rolesAndPermissions');\n    this._connectivityMonitor = connectivityMonitor;\n    this._glipPersons = glipPersons;\n    this._glipPosts = glipPosts;\n    this._tabManager = tabManager;\n\n    this._ttl = ttl;\n    this._timeToRetry = timeToRetry;\n    this._polling = polling;\n    this._perPage = perPage;\n    this._recordCountPerReq = recordCountPerReq;\n    this._preloadPosts = preloadPosts;\n    this._preloadedPosts = {};\n    this._preloadPostsDelayTtl = preloadPostsDelayTtl;\n\n    this._promise = null;\n    this._lastMessage = null;\n\n    this._subscriptionFilters = [subscriptionFilter];\n    if (!disableCache) {\n      this._storage = storage;\n    }\n\n    this._dataStorageKey = 'glipGroupsData';\n    this._timestampStorageKey = 'glipGroupsTimestamp';\n\n    if (this._storage) {\n      this._reducer = getReducer(this.actionTypes);\n\n      this._storage.registerReducer({\n        key: this._dataStorageKey,\n        reducer: getDataReducer(this.actionTypes),\n      });\n      this._storage.registerReducer({\n        key: this._timestampStorageKey,\n        reducer: getTimestampReducer(this.actionTypes),\n      });\n    } else {\n      this._reducer = getReducer(this.actionTypes, {\n        timestamp: getTimestampReducer(this.actionTypes),\n        data: getDataReducer(this.actionTypes),\n      });\n    }\n\n    if (this._glipPosts) {\n      this._glipPosts.addNewPostListener(post => this.onNewPost(post));\n    }\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  async _onStateChange() {\n    if (this._shouldInit()) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      await this._init();\n    } else if (this._isDataReady()) {\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n      this._onDataReady();\n    } else if (this._shouldReset()) {\n      this._clearTimeout();\n      this._promise = null;\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess,\n      });\n    } else if (this._shouldSubscribe()) {\n      this._processSubscription();\n    } else if (\n      this.ready &&\n      this._connectivityMonitor &&\n      this._connectivityMonitor.ready &&\n      this._connectivity !== this._connectivityMonitor.connectivity\n    ) {\n      this._connectivity = this._connectivityMonitor.connectivity;\n      if (!this._connectivity) {\n        return;\n      }\n      await this.fetchData();\n      if (this._preloadPosts) {\n        this._preloadedPosts = {};\n        this._preloadGroupPosts(true);\n      }\n    }\n  }\n\n  _shouldInit() {\n    return !!(\n      this._auth.loggedIn &&\n      this._rolesAndPermissions.ready &&\n      (!this._connectivityMonitor || this._connectivityMonitor.ready) &&\n      (!this._storage || this._storage.ready) &&\n      (!this._readyCheckFn || this._readyCheckFn()) &&\n      (!this._subscription || this._subscription.ready) &&\n      (!this._glipPosts || this._glipPosts.ready) &&\n      (!this._glipPersons || this._glipPersons.ready) &&\n      (!this._tabManager || this._tabManager.ready) &&\n      this.pending\n    );\n  }\n\n  _shouldReset() {\n    return !!(\n      (\n        !this._auth.loggedIn ||\n        !this._rolesAndPermissions.ready ||\n        (this._storage && !this._storage.ready) ||\n        (this._readyCheckFn && !this._readyCheckFn()) ||\n        (this._subscription && !this._subscription.ready) ||\n        (this._glipPosts && !this._glipPosts.ready) ||\n        (this._glipPersons && !this._glipPersons.ready) ||\n        (this._connectivityMonitor && !this._connectivityMonitor.ready) ||\n        (this._tabManager && !this._tabManager.ready)\n      ) &&\n      this.ready\n    );\n  }\n\n  _shouldSubscribe() {\n    return !!(\n      this.ready &&\n      this._subscription &&\n      this._subscription.ready &&\n      this._subscription.message &&\n      this._subscription.message !== this._lastMessage\n    );\n  }\n\n  _onDataReady() {\n    if (this._glipPersons) {\n      this._glipPersons.loadPersons(this.groupMemberIds);\n    }\n    if (this._preloadPosts) {\n      this._preloadedPosts = {};\n      this._preloadGroupPosts();\n    }\n  }\n\n  async _subscriptionHandleFn(message) {\n    if (\n      message &&\n      glipGroupRegExp.test(message.event) &&\n      message.body\n    ) {\n      const {\n        eventType,\n        ...group\n      } = message.body;\n      if (eventType === 'GroupLeft') {\n        this.store.dispatch({\n          type: this.actionTypes.removeGroup,\n          group,\n        });\n        return;\n      }\n      this.store.dispatch({\n        type: this.actionTypes.updateGroup,\n        group,\n      });\n      if (this._glipPersons) {\n        this._glipPersons.loadPersons(group.members);\n      }\n      this._glipPosts.loadPosts(group.id);\n    }\n  }\n\n  _shouldFetch() {\n    return (\n      !this._tabManager || this._tabManager.active\n    );\n  }\n\n  _isDataReady() {\n    return this.status === moduleStatuses.initializing &&\n      this.timestamp !== null;\n  }\n\n  async _init() {\n    if (!this._hasPermission) {\n      return;\n    }\n    if (this._shouldFetch()) {\n      try {\n        await this.fetchData();\n      } catch (e) {\n        console.error('fetchData error:', e);\n        this._retry();\n      }\n    } else if (this._polling) {\n      this._startPolling();\n    } else {\n      this._retry();\n    }\n    if (this._subscription && this._subscriptionFilters) {\n      this._subscription.subscribe(this._subscriptionFilters);\n    }\n    if (this._connectivityMonitor) {\n      this._connectivity = this._connectivityMonitor.connectivity;\n    }\n  }\n\n  _processSubscription() {\n    this._lastMessage = this._subscription.message;\n    this._subscriptionHandleFn(this._lastMessage);\n  }\n\n  async _preloadGroupPosts(force) {\n    const groups = this.groups.slice(0, 20);\n    for (const group of groups) {\n      if (!this._glipPosts) {\n        break;\n      }\n      if (this._preloadedPosts[group.id]) {\n        continue;\n      }\n      this._preloadedPosts[group.id] = true;\n      if (!this._glipPosts.postsMap[group.id] || force) {\n        await sleep(this._preloadPostsDelayTtl);\n        if (!this._glipPosts.postsMap[group.id] || force) {\n          await this._glipPosts.fetchPosts(group.id);\n        }\n      }\n      if (!this._glipPosts.readTimeMap[group.id]) {\n        this._glipPosts.updateReadTime(group.id, (Date.now() - (1000 * 3600 * 2)));\n      }\n    }\n  }\n\n  @proxify\n  updateFilter({ searchFilter, pageNumber }) {\n    this.store.dispatch({\n      type: this.actionTypes.updateFilter,\n      searchFilter,\n      pageNumber,\n    });\n    if (this._preloadPosts && this.groups.length <= this._perPage * 2) {\n      this._preloadGroupPosts();\n    }\n  }\n\n  @proxify\n  updateCurrentGroupId(groupId) {\n    if (!groupId) {\n      return;\n    }\n    const lastGroupId = this.currentGroupId;\n    const lastGroupPosts = this.currentGroupPosts;\n    this.store.dispatch({\n      type: this.actionTypes.updateCurrentGroupId,\n      groupId,\n    });\n    if (this._glipPersons) {\n      this._glipPersons.loadPersons(\n        this.currentGroup && this.currentGroup.members\n      );\n    }\n    if (!this._glipPosts) {\n      return;\n    }\n    if (lastGroupPosts.length > 20) {\n      this._glipPosts.fetchPosts(lastGroupId);\n    }\n    this._glipPosts.loadPosts(groupId);\n    this._glipPosts.updateReadTime(groupId);\n  }\n\n  async _fetchFunction() {\n    const result = await this._client.glip().groups().list({\n      recordCount: this._recordCountPerReq,\n    });\n    return result;\n  }\n\n  async _fetchData() {\n    this.store.dispatch({\n      type: this.actionTypes.fetch,\n    });\n    const { ownerId } = this._auth;\n    try {\n      const data = await this._fetchFunction();\n      if (this._auth.ownerId === ownerId) {\n        this.store.dispatch({\n          type: this.actionTypes.fetchSuccess,\n          data,\n          timestamp: Date.now(),\n        });\n        if (this._polling) {\n          this._startPolling();\n        }\n        this._promise = null;\n      }\n    } catch (error) {\n      if (this._auth.ownerId === ownerId) {\n        this._promise = null;\n        this.store.dispatch({\n          type: this.actionTypes.fetchError,\n          error,\n        });\n        if (this._polling) {\n          this._startPolling(this.timeToRetry);\n        } else {\n          this._retry();\n        }\n        throw error;\n      }\n    }\n  }\n\n  @proxify\n  async fetchData() {\n    if (!this._promise) {\n      this._promise = this._fetchData();\n    }\n    return this._promise;\n  }\n\n  @proxify\n  async startChat(personId) {\n    try {\n      const group = await this._client.glip().groups().post({\n        type: 'PrivateChat',\n        members: [this._auth.ownerId, personId]\n      });\n      group.lastModifiedTime = Date.now();\n      this.store.dispatch({\n        type: this.actionTypes.updateGroup,\n        group,\n      });\n      this.store.dispatch({\n        type: this.actionTypes.updateCurrentGroupId,\n        groupId: group.id,\n      });\n      return group;\n    } catch (e) {\n      console.error(e);\n    }\n    return null;\n  }\n\n  onNewPost(post) {\n    if (post.groupId === this.currentGroupId && this._glipPosts) {\n      this._glipPosts.updateReadTime(post.groupId);\n    }\n  }\n\n  async createTeam(name, members, type = 'Team') {\n    const group = await this._client.glip().groups().post({\n      type,\n      name,\n      members,\n      isPublic: true,\n      description: ''\n    });\n    return group.id;\n  }\n\n  @getter\n  allGroups = createSelector(\n    () => this.data,\n    () => (this._glipPersons && this._glipPersons.personsMap),\n    () => (this._glipPosts && this._glipPosts.postsMap),\n    () => this._auth.ownerId,\n    (data, personsMap = {}, postsMap = {}, ownerId) => (data || []).map(\n      group => formatGroup(group, personsMap, postsMap, ownerId)\n    ),\n  )\n\n  @getter\n  filteredGroups = createSelector(\n    () => this.allGroups,\n    () => this.searchFilter,\n    () => (this._glipPosts && this._glipPosts.postsMap),\n    (allGroups, searchFilter, postsMap = {}) => {\n      if (isBlank(searchFilter)) {\n        return allGroups;\n      }\n      const filterString = searchFilter.toLowerCase();\n      return allGroups.filter((group) => {\n        const name = group.name && group.name.toLowerCase();\n        if (name && name.indexOf(filterString) > -1) {\n          return true;\n        }\n        if (!name) {\n          const groupUsernames = group.detailMembers\n            .map(m => `${m.firstName} ${m.lastName}`)\n            .join(' ')\n            .toLowerCase();\n          if (groupUsernames && groupUsernames.indexOf(filterString) > -1) {\n            return true;\n          }\n        }\n        const result = searchPosts(filterString, postsMap[group.id] || []);\n        return result;\n      });\n    },\n  )\n\n  @getter\n  groups = createSelector(\n    () => this.filteredGroups,\n    (filteredGroups) => {\n      const sortedGroups =\n        filteredGroups.sort((a, b) => {\n          if (a.updatedTime === b.updatedTime) return 0;\n          return a.updatedTime > b.updatedTime ?\n            -1 :\n            1;\n        });\n      return sortedGroups;\n    },\n  )\n\n  @getter\n  uniqueMemberIds = createSelector(\n    () => this.allGroups,\n    getUniqueMemberIds,\n  )\n\n  @getter\n  groupMemberIds = createSelector(\n    () => this.allGroups,\n    (groups) => {\n      const noTeamGroups = groups.filter(g => g.type !== 'Team');\n      return getUniqueMemberIds(noTeamGroups);\n    },\n  )\n\n  @getter\n  currentGroup = createSelector(\n    () => this.allGroups,\n    () => this.currentGroupId,\n    () => (this._glipPersons && this._glipPersons.personsMap) || {},\n    (allGroups, currentGroupId, personsMap) => {\n      const group = allGroups.find(g => g.id === currentGroupId) || {};\n      return formatGroup(group, personsMap, undefined, this._auth.ownerId);\n    },\n  )\n\n  @getter\n  currentGroupPosts = createSelector(\n    () => {\n      const postsMap = (this._glipPosts && this._glipPosts.postsMap) || {};\n      return postsMap[this.currentGroupId];\n    },\n    () => (this._glipPersons && this._glipPersons.personsMap) || {},\n    (posts, personsMap) => {\n      // const posts = postsMap[currentGroupId] || [];\n      const reversePosts = (posts || []).slice(0).reverse();\n      return reversePosts.map((post) => {\n        const creator = personsMap[post.creatorId];\n        return {\n          ...post,\n          sentByMe: post.creatorId === this._auth.ownerId,\n          creator,\n        };\n      });\n    },\n  )\n\n  @getter\n  groupsWithUnread = createSelector(\n    () => this.groups,\n    () => (this._glipPosts && this._glipPosts.postsMap) || {},\n    () => (this._glipPosts && this._glipPosts.readTimeMap) || {},\n    (groups, postsMap, readTimeMap) => groups.map((group) => {\n      const posts = postsMap[group.id] || [];\n      const readTime = readTimeMap[group.id] || Date.now();\n      return {\n        ...group,\n        unread:\n          posts.filter(post =>\n            (new Date(post.creationTime)).getTime() > readTime &&\n            post.creatorId !== this._auth.ownerId\n          ).length\n      };\n    })\n  )\n\n  @getter\n  unreadCounts = createSelector(\n    () => this.groupsWithUnread,\n    groups =>\n      groups.reduce((a, b) => a + b.unread, 0)\n  )\n\n  get searchFilter() {\n    return this.state.searchFilter;\n  }\n\n  get data() {\n    return this._storage ?\n      this._storage.getItem(this._dataStorageKey) :\n      this.state.data;\n  }\n\n  get timestamp() {\n    return this._storage ?\n      this._storage.getItem(this._timestampStorageKey) :\n      this.state.timestamp;\n  }\n\n  get currentGroupId() {\n    return this.state.currentGroupId;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n\n  get ready() {\n    return this.status === moduleStatuses.ready;\n  }\n\n  get pending() {\n    return this.status === moduleStatuses.pending;\n  }\n\n  get ttl() {\n    return this._ttl;\n  }\n\n  get timeToRetry() {\n    return this._timeToRetry;\n  }\n\n  get _hasPermission() {\n    return !!this._rolesAndPermissions.hasGlipPermission;\n  }\n}\n"]}