{"version":3,"sources":["modules/DialerUI/index.js"],"names":["DialerUI","name","deps","dep","optional","call","alert","conferenceCall","subActionTypes","actionTypes","options","_call","ensureExist","_alert","_conferenceCall","_reducer","_callHooks","pending","ready","store","dispatch","type","init","initSuccess","reset","resetSuccess","clearToNumberField","phoneNumber","toNumberField","setToNumberField","recipient","shouldClean","setRecipient","clearRecipient","fromNumber","hook","callSuccess","callError","error","lastRecipient","lastPhoneNumber","warning","message","callErrors","noToNumber","loadLastCallState","fromSessionId","trim","length","_loadLastPhoneNumber","_onBeforeCall","closeMergingPair","state","status","RcModule","proxify"],"mappings":"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","file":"index.js","sourcesContent":["import RcModule from 'ringcentral-integration/lib/RcModule';\nimport { Module } from 'ringcentral-integration/lib/di';\nimport proxify from 'ringcentral-integration/lib/proxy/proxify';\nimport ensureExist from 'ringcentral-integration/lib/ensureExist';\nimport callErrors from 'ringcentral-integration/modules/Call/callErrors';\nimport actionTypes from './actionTypes';\nimport getReducer from './getReducer';\n\n@Module({\n  name: 'DialerUI',\n  deps: [\n    'Call',\n    'Alert',\n    { dep: 'ConferenceCall', optional: true },\n    { dep: 'DialerUIOptions', optional: true },\n  ],\n})\nexport default class DialerUI extends RcModule {\n  constructor({\n    call,\n    alert,\n    conferenceCall,\n    actionTypes: subActionTypes,\n    ...options\n  }) {\n    super({\n      ...options,\n      actionTypes: (subActionTypes || actionTypes),\n    });\n\n    this._call = this:: ensureExist(call, 'call');\n    this._alert = this:: ensureExist(alert, 'alert');\n    this._conferenceCall = conferenceCall;\n    this._reducer = getReducer(this.actionTypes);\n    this._callHooks = [];\n  }\n\n  async _onStateChange() {\n    if (\n      this.pending &&\n      this._call.ready\n    ) {\n      this.store.dispatch({\n        type: this.actionTypes.init,\n      });\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess,\n      });\n    } else if (\n      this.ready &&\n      (\n        !this._call.ready\n      )\n    ) {\n      this.store.dispatch({\n        type: this.actionTypes.reset,\n      });\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess,\n      });\n    }\n  }\n\n  @proxify\n  async clearToNumberField() {\n    this.store.dispatch({\n      type: this.actionTypes.clearToNumberField,\n    });\n  }\n\n  @proxify\n  async setToNumberField(phoneNumber) {\n    if (this.toNumberField !== phoneNumber) {\n      this.store.dispatch({\n        type: this.actionTypes.setToNumberField,\n        phoneNumber,\n      });\n    }\n  }\n\n  @proxify\n  async setRecipient(recipient, shouldClean = true) {\n    this.store.dispatch({\n      type: this.actionTypes.setRecipient,\n      recipient,\n    });\n    if (shouldClean) {\n      await this.clearToNumberField();\n    }\n  }\n  @proxify\n  async clearRecipient() {\n    this.store.dispatch({\n      type: this.actionTypes.clearRecipient,\n    });\n  }\n\n  @proxify\n  async call({\n    phoneNumber = '',\n    recipient = null,\n    fromNumber = null,\n  }) {\n    if (phoneNumber || recipient) {\n      this.store.dispatch({\n        type: this.actionTypes.call,\n        phoneNumber,\n        recipient,\n      });\n      for (const hook of this._callHooks) {\n        await hook({\n          phoneNumber,\n          recipient,\n          fromNumber,\n        });\n      }\n      try {\n        await this._call.call({\n          phoneNumber: this.toNumberField,\n          recipient: this.recipient,\n          fromNumber,\n        });\n        this.store.dispatch({\n          type: this.actionTypes.callSuccess,\n        });\n      } catch (error) {\n        this.store.dispatch({\n          type: this.actionTypes.callError,\n          error,\n        });\n      }\n    }\n  }\n\n  _loadLastPhoneNumber() {\n    if (!this._call.lastRecipient && !this._call.lastPhoneNumber) {\n      this._alert.warning({\n        message: callErrors.noToNumber,\n      });\n    } else {\n      this.store.dispatch({\n        type: this.actionTypes.loadLastCallState,\n        phoneNumber: this._call.lastPhoneNumber,\n        recipient: this._call.lastRecipient,\n      });\n    }\n  }\n\n  @proxify\n  async onCallButtonClick({ fromNumber, fromSessionId } = {}) {\n    if (\n      `${this.toNumberField}`.trim().length === 0 &&\n      !this.recipient\n    ) {\n      this._loadLastPhoneNumber();\n    } else {\n      this._onBeforeCall(fromSessionId);\n      await this.call({\n        phoneNumber: this.toNumberField,\n        recipient: this.recipient,\n        fromNumber,\n      });\n    }\n  }\n\n  _onBeforeCall() {\n    if (this._conferenceCall) {\n      this._conferenceCall.closeMergingPair();\n    }\n  }\n\n  get toNumberField() {\n    return this.state.toNumberField;\n  }\n\n  get recipient() {\n    return this.state.recipient;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n}\n"]}