{"version":3,"sources":["modules/QuickAccess/index.js"],"names":["QuickAccess","deps","auth","webphone","options","actionTypes","_auth","_webphone","_reducer","store","subscribe","_onStateChange","ready","dispatch","type","initSuccess","resetSuccess","ringSession","_lastRingSession","exit","updatePage","entered","state","status","RcModule","proxify"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IASqBA,W,WAPpB,gBAAO;AACNC,QAAM,CACJ,MADI,EAEJ,SAFI,EAGJ,UAHI;AADA,CAAP,C;;;AAQC,6BAIG;AAAA,QAHDC,IAGC,QAHDA,IAGC;AAAA,QAFDC,QAEC,QAFDA,QAEC;AAAA,QADEC,OACF;AAAA;;AAAA;AAECC;AAFD,OAGID,OAHJ;;AAKD,UAAKE,KAAL,GAAaJ,IAAb;AACA,UAAKK,SAAL,GAAiBJ,QAAjB;AACA,UAAKK,QAAL,GAAgB,qCAAsB,MAAKH,WAA3B,CAAhB;AAPC;AAQF;;;;iCAEY;AAAA;;AACX,WAAKI,KAAL,CAAWC,SAAX,CAAqB;AAAA,eAAM,OAAKC,cAAL,EAAN;AAAA,OAArB;AACD;;;;;;;;;AAGC,oBAAI,KAAKL,KAAL,CAAWM,KAAX,IAAoB,CAAC,KAAKA,KAA9B,EAAqC;AACnC,uBAAKH,KAAL,CAAWI,QAAX,CAAoB;AAClBC,0BAAM,KAAKT,WAAL,CAAiBU;AADL,mBAApB;AAGD,iBAJD,MAIO,IAAI,CAAC,KAAKT,KAAL,CAAWM,KAAZ,IAAqB,KAAKA,KAA9B,EAAqC;AAC1C,uBAAKH,KAAL,CAAWI,QAAX,CAAoB;AAClBC,0BAAM,KAAKT,WAAL,CAAiBW;AADL,mBAApB;AAGD;AACD;AACA;AACA,oBACE,KAAKT,SAAL,CAAeK,KAAf,IACA,KAAKL,SAAL,CAAeU,WADf,IAEA,KAAKV,SAAL,CAAeU,WAAf,KAA+B,KAAKC,gBAHtC,EAIE;AACA,uBAAKA,gBAAL,GAAwB,KAAKX,SAAL,CAAeU,WAAvC;AACA,uBAAKE,IAAL;AACD;;;;;;;;;;;;;;;;;;;;;;;;AAMD,qBAAKV,KAAL,CAAWI,QAAX,CAAoB;AAClBC,wBAAM,KAAKT,WAAL,CAAiBe,UADL;AAElBC,2BAAS;AAFS,iBAApB;;;;;;;;;;;;;;;;;;;;;;;;AASA,qBAAKZ,KAAL,CAAWI,QAAX,CAAoB;AAClBC,wBAAM,KAAKT,WAAL,CAAiBe,UADL;AAElBC,2BAAS;AAFS,iBAApB;;;;;;;;;;;;;;;;;;wBAMY;AACZ,aAAO,KAAKC,KAAL,CAAWD,OAAlB;AACD;;;wBAEY;AACX,aAAO,KAAKC,KAAL,CAAWC,MAAlB;AACD;;;EAjEsCC,kB,2DA0CtCC,iB,kJASAA,iB;kBAnDkBzB,W","file":"index.js","sourcesContent":["import RcModule from '../../lib/RcModule';\nimport proxify from '../../lib/proxy/proxify';\nimport { Module } from '../../lib/di';\nimport actionTypes from './actionTypes';\nimport getQuickAccessReducer from './getQuickAccessReducer';\n\n@Module({\n  deps: [\n    'Auth',\n    'Storage',\n    'Webphone'\n  ]\n})\nexport default class QuickAccess extends RcModule {\n  constructor({\n    auth,\n    webphone,\n    ...options\n  }) {\n    super({\n      actionTypes,\n      ...options\n    });\n    this._auth = auth;\n    this._webphone = webphone;\n    this._reducer = getQuickAccessReducer(this.actionTypes);\n  }\n\n  initialize() {\n    this.store.subscribe(() => this._onStateChange());\n  }\n\n  async _onStateChange() {\n    if (this._auth.ready && !this.ready) {\n      this.store.dispatch({\n        type: this.actionTypes.initSuccess\n      });\n    } else if (!this._auth.ready && this.ready) {\n      this.store.dispatch({\n        type: this.actionTypes.resetSuccess\n      });\n    }\n    // When there is an incoming call,\n    // the page should be dismissed\n    if (\n      this._webphone.ready &&\n      this._webphone.ringSession &&\n      this._webphone.ringSession !== this._lastRingSession\n    ) {\n      this._lastRingSession = this._webphone.ringSession;\n      this.exit();\n    }\n  }\n\n\n  @proxify\n  async enter() {\n    this.store.dispatch({\n      type: this.actionTypes.updatePage,\n      entered: true\n    });\n  }\n\n\n  @proxify\n  async exit() {\n    this.store.dispatch({\n      type: this.actionTypes.updatePage,\n      entered: false\n    });\n  }\n\n  get entered() {\n    return this.state.entered;\n  }\n\n  get status() {\n    return this.state.status;\n  }\n}\n\n"]}